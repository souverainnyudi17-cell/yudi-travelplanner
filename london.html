<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéÑ London Christmas 2026 - YUDI</title>
  <meta name="theme-color" content="#dc2626">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icon-192.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .snow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; opacity: 0.3; z-index: 1; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Ccircle fill='%23fff' cx='100' cy='100' r='2'/%3E%3Ccircle fill='%23fff' cx='300' cy='150' r='3'/%3E%3Ccircle fill='%23fff' cx='450' cy='80' r='2'/%3E%3C/svg%3E"); background-size: 512px 512px; animation: snow 15s linear infinite; }
    @keyframes snow { from { background-position: 0 0; } to { background-position: 0 512px; } }
    .content { position: relative; z-index: 2; }
    /* Dark mode */
    body.dark { background: linear-gradient(135deg, #1f2937, #111827, #1f2937) !important; }
    body.dark .bg-white { background: #1f2937 !important; }
    body.dark .text-gray-800 { color: #f3f4f6 !important; }
    body.dark .text-gray-700 { color: #e5e7eb !important; }
    body.dark .text-gray-600 { color: #d1d5db !important; }
    body.dark .text-gray-500 { color: #9ca3af !important; }
    body.dark .bg-gray-50 { background: #374151 !important; }
    body.dark .bg-gray-100 { background: #374151 !important; }
    body.dark .border-gray-100 { border-color: #4b5563 !important; }
    body.dark .border-gray-200 { border-color: #4b5563 !important; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-red-900 via-green-900 to-slate-900">
  <div class="snow"></div>
  <div class="content">
    <div id="app" class="p-4 max-w-4xl mx-auto"></div>
  </div>

  <script>
    // STATE
    let activeDay = 1;
    let activeTab = 'planning';
    let selectedModal = null;
    let darkMode = localStorage.getItem('londonDarkMode') === 'true';
    let checklist = JSON.parse(localStorage.getItem('londonChecklist') || '{}');
    let expenses = JSON.parse(localStorage.getItem('londonExpenses') || '[]');
    let dayNotes = JSON.parse(localStorage.getItem('londonDayNotes') || '{}');
    let packingList = JSON.parse(localStorage.getItem('londonPackingList') || '{}');
    let tripPhotos = JSON.parse(localStorage.getItem('londonPhotos') || '{}');

    // Photo gallery functions
    function addPhoto(dayNum) {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            if (!tripPhotos[dayNum]) tripPhotos[dayNum] = [];
            tripPhotos[dayNum].push({ src: e.target.result, date: new Date().toISOString() });
            localStorage.setItem('londonPhotos', JSON.stringify(tripPhotos));
            render();
          };
          reader.readAsDataURL(file);
        }
      };
      input.click();
    }

    function deletePhoto(dayNum, idx) {
      if (confirm('Foto verwijderen?')) {
        tripPhotos[dayNum].splice(idx, 1);
        localStorage.setItem('londonPhotos', JSON.stringify(tripPhotos));
        render();
      }
    }

    let weatherData = null;
    let weatherLoading = false;

    // Packing list categories for London
    const packingCategories = {
      documents: { title: 'üìÑ Documenten', items: ['Paspoort / ID-kaart', 'Bevestigingen (hotel, shows)', 'Reisverzekering', 'Oyster card (online besteld)', 'GBP cash / pinpas'] },
      winterwonderland: { title: 'üé° Winter Wonderland', items: ['Handschoenen (schaatsen!)', 'Muts', 'Warme sokken', 'Jas met zakken (voor spullen in attracties)'] },
      kerst: { title: '‚ùÑÔ∏è Winter in London', items: ['Dikke winterjas', 'Sjaal', 'Warme trui/vest', 'Waterdichte schoenen', 'Paraplu!', 'Thermisch ondergoed (optioneel)'] },
      show: { title: 'üé≠ West End Show', items: ['Nette outfit', 'Comfortabele nette schoenen'] },
      algemeen: { title: 'üëï Kleding (4 dagen)', items: ['Dagelijkse outfits (4x)', 'Ondergoed (4x)', 'Sokken (4x)', 'Pyjama', 'Comfortabele wandelschoenen'] },
      tech: { title: 'üì± Elektronica', items: ['Telefoon + oplader', 'UK adapter/stekker!', 'Powerbank', 'Camera', 'Koptelefoon'] },
      toilettas: { title: 'üß¥ Toilettas', items: ['Tandenborstel & pasta', 'Deodorant', 'Shampoo (mini)', 'Medicijnen', 'Lippenbalsem'] }
    };

    function togglePacking(key) {
      packingList[key] = !packingList[key];
      localStorage.setItem('londonPackingList', JSON.stringify(packingList));
      render();
    }

    // Weather coordinates for London
    const weatherLocations = {
      london: { lat: 51.51, lon: -0.13, name: 'London' }
    };

    // Fetch current weather
    async function fetchWeather() {
      if (weatherLoading || weatherData) return;
      weatherLoading = true;
      try {
        const loc = weatherLocations.london;
        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${loc.lat}&longitude=${loc.lon}&current=temperature_2m,weather_code,wind_speed_10m&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=auto&forecast_days=3`);
        weatherData = await res.json();
        render();
      } catch (e) { console.log('Weather fetch failed:', e); }
      weatherLoading = false;
    }

    // Weather code to emoji
    function getWeatherEmoji(code) {
      if (code <= 3) return '‚òÄÔ∏è';
      if (code <= 48) return '‚òÅÔ∏è';
      if (code <= 67) return 'üåßÔ∏è';
      if (code <= 77) return 'üå®Ô∏è';
      if (code <= 82) return 'üåßÔ∏è';
      if (code >= 95) return '‚õàÔ∏è';
      return 'üå§Ô∏è';
    }

    if (darkMode) document.body.classList.add('dark');

    const trip = {
      title: 'üéÑ London Christmas',
      subtitle: 'Winter Wonderland',
      dates: '27-30 nov 2026',
      duration: '4 dagen',
      persons: 2
    };

    const accommodations = {
      london: {
        name: 'Hotel Central London',
        area: 'Covent Garden / South Bank',
        nights: 3,
        price: '‚Ç¨400-500',
        lat: 51.512, lng: -0.123
      }
    };

    const locations = {
      stansted: { lat: 51.885, lng: 0.235 },
      covent_garden: { lat: 51.512, lng: -0.123 },
      winter_wonderland: { lat: 51.507, lng: -0.165 },
      southbank: { lat: 51.506, lng: -0.116 },
      london_eye: { lat: 51.503, lng: -0.119 },
      borough_market: { lat: 51.505, lng: -0.091 },
      harrods: { lat: 51.499, lng: -0.163 },
      oxford_street: { lat: 51.515, lng: -0.142 },
      carnaby: { lat: 51.513, lng: -0.139 },
      somerset_house: { lat: 51.511, lng: -0.117 },
      trafalgar: { lat: 51.508, lng: -0.128 },
      leicester: { lat: 51.511, lng: -0.128 },
      natural_history: { lat: 51.496, lng: -0.176 }
    };

    function calcDist(loc1, loc2) {
      if (!locations[loc1] || !locations[loc2]) return null;
      const R = 6371;
      const l1 = locations[loc1], l2 = locations[loc2];
      const dLat = (l2.lat - l1.lat) * Math.PI / 180;
      const dLon = (l2.lng - l1.lng) * Math.PI / 180;
      const a = Math.sin(dLat/2)**2 + Math.cos(l1.lat * Math.PI/180) * Math.cos(l2.lat * Math.PI/180) * Math.sin(dLon/2)**2;
      return Math.round(R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
    }

    function estTime(km) {
      if (!km) return '';
      const min = Math.round(km / 30 * 60);
      return min < 60 ? `~${min} min` : `~${Math.floor(min/60)}u ${min%60}min`;
    }

    function getMapsUrl(loc) {
      if (!locations[loc]) return null;
      return `https://www.google.com/maps/search/?api=1&query=${locations[loc].lat},${locations[loc].lng}`;
    }

    const days = [
      { day: 1, date: 'Do 27 nov', title: 'Aankomst & South Bank', icon: '‚úàÔ∏è', area: 'South Bank', highlight: 'London Eye + Kerst sfeer', accom: 'london', weather: { high: 10, low: 5, icon: 'üåßÔ∏è', rain: 40 } },
      { day: 2, date: 'Vr 28 nov', title: 'Winter Wonderland', icon: 'üé°', area: 'Hyde Park', highlight: 'Magisch kerstpark!', featured: true, accom: 'london', weather: { high: 9, low: 4, icon: '‚òÅÔ∏è', rain: 35 } },
      { day: 3, date: 'Za 29 nov', title: 'Shopping & Shows', icon: 'üéÅ', area: 'West End', highlight: 'Oxford Street lichtjes', featured: true, accom: 'london', weather: { high: 10, low: 5, icon: 'üå§Ô∏è', rain: 30, note: 'üåô Donker om 16:00 - perfecte kerstlichtjes!' } },
      { day: 4, date: 'Zo 30 nov', title: 'Vertrek', icon: 'üè†', area: 'Centrum', highlight: 'Laatste kerstsfeer', accom: null, weather: { high: 9, low: 4, icon: '‚òÅÔ∏è', rain: 35 } }
    ];

    const activities = {
      1: [
        { time: '07:00', icon: '‚úàÔ∏è', title: 'Vlucht Amsterdam ‚Üí London', subtitle: 'Stansted', type: 'transport', loc: 'stansted', info: { desc: 'Vlucht naar London Stansted Airport', price: '‚Ç¨50-100 p.p. retour', duration: '~1 uur', tips: ['Check-in 2 uur van tevoren', 'Handbagage = goedkoper'] } },
        { time: '10:00', icon: 'üöÉ', title: 'Stansted Express', subtitle: 'Naar Liverpool Street', type: 'transport', loc: 'stansted', info: { desc: 'Snelle trein naar centrum Londen', price: '¬£19-23 p.p.', duration: '47 min', tips: ['Boek online = goedkoper', 'Oyster card kopen op station'], website: 'stanstedexpress.com' } },
        { time: '11:30', icon: 'üè†', title: 'Check-in hotel', subtitle: 'Bagage droppen', type: 'accommodation', loc: 'covent_garden', info: { desc: 'Inchecken hotel centrum Londen', price: '‚Ç¨400-500 totaal (3 nachten)', tips: ['Vroeg inchecken vaak mogelijk', 'Bagage opslaan als kamer niet klaar'] } },
        { time: '12:30', icon: '‚≠ê', title: 'Borough Market', subtitle: 'Beste foodmarkt!', type: 'highlight', loc: 'borough_market', info: { desc: 'Historische overdekte markt met heerlijk streetfood!', highlights: ['Raclette', 'Scotch eggs', 'Mince pies'], price: '‚Ç¨10-20 p.p.', tips: ['Druk in weekend', 'Cash handig'], mustTry: ['Mulled wine üç∑', 'Fresh oysters'], mustSee: true } },
        { time: '14:30', icon: 'üö∂', title: 'South Bank wandeling', subtitle: 'Langs de Theems', type: 'highlight', loc: 'southbank', info: { desc: 'Sfeervolle wandeling langs de Theems met kerstmarkt kraampjes!', highlights: ['Tate Modern (gratis!)', 'Millennium Bridge', 'Kerstkraampjes'], duration: '2-3 uur', tips: ['Straatmuzikanten geven fooien'], mustSee: true } },
        { time: '17:00', icon: 'üé°', title: 'London Eye', subtitle: 'Zonsondergang views!', type: 'highlight', loc: 'london_eye', info: { desc: 'Spectaculair uitzicht over Londen bij zonsondergang!', price: '¬£30-36 p.p.', duration: '30 min', tips: ['Boek online = skip the line', 'Zonsondergang ~16:00 in november'], website: 'londoneye.com', mustSee: true } },
        { time: '18:30', icon: 'üéÑ', title: 'Southbank Christmas Market', subtitle: 'Gl√ºhwein & kraampjes', type: 'activity', loc: 'southbank', info: { desc: 'Gezellige kerstmarkt met houten chalets', mustTry: ['Mulled wine', 'German sausages', 'Churros'], tips: ['Sfeervoller na donker', 'Gratis toegang'] } },
        { time: '20:00', icon: 'üçΩÔ∏è', title: 'Diner', subtitle: 'Kerst pub dinner', type: 'food', loc: 'southbank', info: { desc: 'Traditionele Engelse pub met kerstsfeer', price: '‚Ç¨20-35 p.p.', mustTry: ['Fish & Chips', 'Sticky Toffee Pudding'], recommendations: ['The Anchor Bankside', 'Founders Arms'] } }
      ],
      2: [
        { time: '09:30', icon: 'üç≥', title: 'Ontbijt', subtitle: 'Full English!', type: 'food', loc: 'covent_garden', info: { desc: 'Traditioneel Engels ontbijt', price: '‚Ç¨12-18 p.p.', mustTry: ['Full English Breakfast', 'Eggs Benedict'], recommendations: ['The Breakfast Club', "Bill's"] } },
        { time: '11:00', icon: '‚≠ê', title: 'WINTER WONDERLAND', subtitle: 'Magisch kerstpark!', type: 'highlight', loc: 'winter_wonderland', info: { desc: "Europa's grootste gratis kerstevenement in Hyde Park!", highlights: ['üé¢ Attracties & reuzenrad', '‚õ∏Ô∏è Grootste ijsbaan UK', 'üç∫ Bavarian Village', 'üé™ Circus shows'], price: 'GRATIS entree, attracties ‚Ç¨3-10', duration: '4-6 uur', tips: ['Boek ijsbaan vooraf!', 'Druk in weekenden', 'Ga doordeweeks = rustiger'], website: 'hydeparkwinterwonderland.com', mustSee: true, warning: '‚ö†Ô∏è Boek ijsbaan + attracties VOORAF online!' } },
        { time: '12:30', icon: 'üç∫', title: 'Lunch Bavarian Village', subtitle: 'Bratwurst & Gl√ºhwein!', type: 'food', loc: 'winter_wonderland', info: { desc: 'Authentiek Duits kerstdorp met live muziek!', price: '‚Ç¨15-25 p.p.', mustTry: ['Bratwurst', 'Schweinshaxe', 'Gl√ºhwein', 'Kaiserschmarrn'] } },
        { time: '14:00', icon: '‚õ∏Ô∏è', title: 'Ice Skating', subtitle: 'Grootste ijsbaan UK!', type: 'highlight', loc: 'winter_wonderland', info: { desc: 'Schaatsen op de gigantische ijsbaan!', price: '¬£15-20 p.p.', duration: '1 uur sessie', tips: ['VOORAF BOOKEN VERPLICHT', 'Handschoenen meenemen', 'Schaatsen inbegrepen'], website: 'hydeparkwinterwonderland.com', mustSee: true, warning: 'VOORAF BOEKEN!' } },
        { time: '15:30', icon: 'üé¢', title: 'Attracties', subtitle: 'Reuzenrad & meer!', type: 'activity', loc: 'winter_wonderland', info: { desc: 'Diverse attracties in Winter Wonderland', highlights: ['Giant Wheel (reuzenrad)', 'Ice Mountain', 'Magical Ice Kingdom'], price: '‚Ç¨5-12 per attractie', tips: ['Koop tokens ter plekke', 'Reuzenrad = beste uitzicht'] } },
        { time: '19:00', icon: 'üåÉ', title: 'Wonderland by night', subtitle: 'Lichtjes & sfeer', type: 'activity', loc: 'winter_wonderland', info: { desc: 'Winter Wonderland is het mooist na donker!', tips: ['Maak fotos bij het reuzenrad', 'Laatste ronde Gl√ºhwein'] } },
        { time: '20:30', icon: 'üçΩÔ∏è', title: 'Diner West End', subtitle: 'Pre-theatre menu', type: 'food', loc: 'covent_garden', info: { desc: 'Diner in het bruisende West End', price: '‚Ç¨25-40 p.p.', recommendations: ['Dishoom (Indian)', 'Flat Iron (steak)', 'Hoppers'] } }
      ],
      3: [
        { time: '10:00', icon: 'üè¨', title: 'Harrods Christmas', subtitle: 'Iconische decoratie!', type: 'highlight', loc: 'harrods', info: { desc: 'Het beroemdste warenhuis ter wereld in kerstglorie!', highlights: ['Christmas Windows', 'Food Halls', 'Christmas World (5e etage)'], duration: '1.5-2 uur', tips: ['Gratis entree', 'Food Halls zijn een must!'], mustSee: true } },
        { time: '12:00', icon: 'üèõÔ∏è', title: 'Natural History Museum', subtitle: 'Ijsbaan + kerstboom!', type: 'highlight', loc: 'natural_history', info: { desc: 'Schaatsen voor het prachtige museum!', highlights: ['Ice Rink', 'Gigantische kerstboom', 'Dinosaurus!'], price: 'Museum GRATIS, ijsbaan ¬£16-20', tips: ['Boek ijsbaan vooraf', 'Museum gratis!'], mustSee: true } },
        { time: '14:00', icon: 'üçΩÔ∏è', title: 'Lunch', subtitle: 'South Kensington', type: 'food', loc: 'natural_history', info: { desc: 'Lunch in chique South Kensington', price: '‚Ç¨15-25 p.p.', recommendations: ['The Anglesea Arms', "Muriel's Kitchen"] } },
        { time: '15:30', icon: '‚ú®', title: 'Oxford Street Lights', subtitle: '1 km kerstverlichting!', type: 'highlight', loc: 'oxford_street', info: { desc: 'De beroemdste kerstverlichting van Londen!', highlights: ['1 miljoen+ lampjes', 'Selfridges windows'], duration: '1-2 uur', tips: ['Mooist na 16:00 (donker)', 'Selfridges windows zijn iconisch'], mustSee: true } },
        { time: '16:30', icon: 'üéÄ', title: 'Carnaby Street', subtitle: 'Unieke decoraties!', type: 'highlight', loc: 'carnaby', info: { desc: 'Elk jaar een ander spectaculair thema!', tips: ['Vlakbij Oxford Street', 'Liberty warenhuis vlakbij'], mustSee: true } },
        { time: '17:30', icon: 'üéÑ', title: 'Covent Garden Christmas', subtitle: 'Gigantische kerstboom!', type: 'highlight', loc: 'covent_garden', info: { desc: 'Betoverende kerstsfeer met reusachtige kerstboom!', highlights: ['Enorme kerstboom', 'Mistletoe installatie', 'Straatartiesten'], duration: '1-2 uur', tips: ['Gratis entree', 'Street performers zijn geweldig'], mustSee: true } },
        { time: '19:00', icon: '‚õ∏Ô∏è', title: 'Somerset House', subtitle: 'Romantische ijsbaan!', type: 'activity', loc: 'somerset_house', info: { desc: 'Schaatsen in betoverende 18e-eeuwse binnenplaats!', price: '¬£12-22 p.p.', duration: '1 uur sessie', tips: ['Skate Lates: DJ nights (do-za)', "Fortnum's Lodge voor champagne"], website: 'somersethouse.org.uk', warning: 'BOEK VOORAF - zeer populair!' } },
        { time: '20:30', icon: 'üé≠', title: 'West End Show', subtitle: 'Musical magic!', type: 'highlight', loc: 'leicester', info: { desc: 'Geen Londen trip compleet zonder een West End show!', recommendations: ['The Lion King', 'Wicked', 'Hamilton', 'Les Mis√©rables'], price: '¬£30-150 p.p.', duration: '2.5-3 uur', tips: ['Boek VOORAF', 'TKTS booth voor last-minute deals'], website: 'londontheatredirect.com', mustSee: true } }
      ],
      4: [
        { time: '09:00', icon: 'üç≥', title: 'Ontbijt & uitchecken', subtitle: 'Laatste Full English!', type: 'food', loc: 'covent_garden', info: { desc: 'Laatste ontbijt en uitchecken', tips: ['Bagage bij hotel laten als vlucht later is'] } },
        { time: '10:30', icon: 'üéÑ', title: 'Trafalgar Square', subtitle: 'Noorse kerstboom', type: 'activity', loc: 'trafalgar', info: { desc: 'De beroemde Noorse kerstboom - geschonken sinds 1947!', highlights: ['National Gallery (gratis)', 'Historische kerstboom'], tips: ['Goede laatste stop'], duration: '30 min' } },
        { time: '11:30', icon: 'üõçÔ∏è', title: 'Leicester Square Market', subtitle: 'Laatste souvenirs', type: 'activity', loc: 'leicester', info: { desc: 'Kleine kerstmarkt voor last-minute cadeautjes', tips: ["M&M's World vlakbij", 'Chinatown op loopafstand'] } },
        { time: '13:00', icon: 'üöÉ', title: 'Naar vliegveld', subtitle: 'Stansted Express', type: 'transport', loc: 'stansted', info: { desc: 'Terug naar Stansted Airport', price: '¬£19-23 p.p.', tips: ['2.5 uur voor vlucht vertrekken'] } },
        { time: '17:00', icon: '‚úàÔ∏è', title: 'Vlucht ‚Üí Amsterdam', subtitle: 'Tot ziens London!', type: 'transport', loc: 'stansted', info: { desc: 'Vlucht terug naar Nederland', tips: ['Tax free shopping op vliegveld'] } }
      ]
    };

    const budget = {
      estimated: [
        { item: '‚úàÔ∏è Vluchten (2p retour)', budget: 150, comfort: 250 },
        { item: 'üè® Hotel 3 nachten', budget: 400, comfort: 600 },
        { item: 'üöÉ Stansted Express (2p)', budget: 76, comfort: 76 },
        { item: 'üöá Oyster card', budget: 50, comfort: 50 },
        { item: 'üé° London Eye (2p)', budget: 60, comfort: 72 },
        { item: '‚õ∏Ô∏è Ice skating 2x (2p)', budget: 60, comfort: 80 },
        { item: 'üé¢ Winter Wonderland', budget: 40, comfort: 60 },
        { item: 'üé≠ West End Show (2p)', budget: 80, comfort: 200 },
        { item: 'üçΩÔ∏è Eten (4 dagen)', budget: 200, comfort: 350 },
        { item: 'üéÅ Shopping', budget: 50, comfort: 150 },
        { item: 'üí∞ Buffer', budget: 34, comfort: 62 }
      ]
    };

    const checklistSections = [
      { title: 'üî¥ NU BOEKEN (Nov = druk!)', items: [
        { key: 'flights', label: '‚úàÔ∏è Vluchten Amsterdam ‚Üî London' },
        { key: 'hotel', label: 'üè® Hotel (centrum!)' },
        { key: 'winterWonderland', label: '‚õ∏Ô∏è Winter Wonderland ijsbaan' },
        { key: 'somersetHouse', label: '‚õ∏Ô∏è Somerset House ijsbaan' },
        { key: 'westEnd', label: 'üé≠ West End Show tickets' }
      ]},
      { title: 'üü† WEEK VAN TEVOREN', items: [
        { key: 'stanstedExpress', label: 'üöÉ Stansted Express tickets' },
        { key: 'londonEye', label: 'üé° London Eye tickets' },
        { key: 'oyster', label: 'üí≥ Oyster card' }
      ]},
      { title: 'üß≥ INPAKKEN', items: [
        { key: 'passport', label: 'Paspoort' },
        { key: 'warmClothes', label: 'Warme jas & sjaal' },
        { key: 'gloves', label: 'Handschoenen (schaatsen!)' },
        { key: 'umbrella', label: 'Paraplu (Londen = regen!)' },
        { key: 'adapter', label: 'UK stekker adapter' }
      ]}
    ];

    // Initialize checklist
    checklistSections.forEach(sec => sec.items.forEach(i => { if (checklist[i.key] === undefined) checklist[i.key] = false; }));

    function getTypeClass(type) {
      const classes = {
        transport: 'bg-gradient-to-r from-amber-100 to-yellow-100 border-l-4 border-amber-500',
        accommodation: 'bg-gradient-to-r from-amber-100 to-yellow-100 border-l-4 border-yellow-500',
        highlight: 'bg-gradient-to-r from-red-100 to-pink-100 border-l-4 border-red-500',
        food: 'bg-gradient-to-r from-green-100 to-emerald-100 border-l-4 border-green-500',
        activity: 'bg-gradient-to-r from-purple-100 to-violet-100 border-l-4 border-purple-500',
        warning: 'bg-gradient-to-r from-red-200 to-rose-200 border-l-4 border-red-600'
      };
      return classes[type] || 'bg-gray-100 border-l-4 border-gray-400';
    }

    function setDay(d) { activeDay = d; render(); }
    function setTab(t) { activeTab = t; render(); }
    function openModal(act) { selectedModal = act; render(); }
    function closeModal() { selectedModal = null; render(); }
    function toggleCheck(key) { checklist[key] = !checklist[key]; localStorage.setItem('londonChecklist', JSON.stringify(checklist)); render(); }
    function toggleDarkMode() { darkMode = !darkMode; localStorage.setItem('londonDarkMode', darkMode.toString()); document.body.classList.toggle('dark', darkMode); render(); }

    function addExpense() {
      const desc = document.getElementById('expenseDesc')?.value;
      const amount = parseFloat(document.getElementById('expenseAmount')?.value);
      const cat = document.getElementById('expenseCategory')?.value || 'üí∞ Overig';
      if (desc && amount > 0) {
        expenses.push({ id: Date.now(), desc, amount, category: cat });
        localStorage.setItem('londonExpenses', JSON.stringify(expenses));
        render();
      }
    }
    function deleteExpense(id) { expenses = expenses.filter(e => e.id !== id); localStorage.setItem('londonExpenses', JSON.stringify(expenses)); render(); }

    function saveNote() {
      const note = document.getElementById('dayNoteInput')?.value;
      if (note && note.trim()) {
        if (!dayNotes[activeDay]) dayNotes[activeDay] = [];
        dayNotes[activeDay].push({ id: Date.now(), text: note, ts: new Date().toLocaleString('nl-NL') });
        localStorage.setItem('londonDayNotes', JSON.stringify(dayNotes));
        render();
      }
    }
    function deleteNote(id) { dayNotes[activeDay] = (dayNotes[activeDay] || []).filter(n => n.id !== id); localStorage.setItem('londonDayNotes', JSON.stringify(dayNotes)); render(); }

    function shareTrip() {
      if (navigator.share) navigator.share({ title: trip.title, url: window.location.href });
      else { navigator.clipboard.writeText(window.location.href); alert('Link gekopieerd!'); }
    }

    function exportTrip() {
      let txt = `${trip.title}\n${trip.dates}\n\n`;
      days.forEach(d => {
        txt += `=== DAG ${d.day}: ${d.title} ===\n`;
        (activities[d.day] || []).forEach(a => { txt += `${a.time} - ${a.title}\n`; });
        txt += '\n';
      });
      const blob = new Blob([txt], { type: 'text/plain' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'london-christmas.txt'; a.click();
    }

    // MAIN RENDER
    function render() {
      const day = days[activeDay - 1];
      const acts = activities[activeDay] || [];
      const accom = day.accom ? accommodations[day.accom] : null;

      const estBudget = budget.estimated.reduce((s, i) => s + i.budget, 0);
      const estComfort = budget.estimated.reduce((s, i) => s + i.comfort, 0);
      const totalExpenses = expenses.reduce((s, e) => s + e.amount, 0);
      const checkedCount = Object.values(checklist).filter(Boolean).length;
      const totalChecks = checklistSections.reduce((s, sec) => s + sec.items.length, 0);

      const tripDate = new Date('2026-11-27T00:00:00');
      const now = new Date();
      const diff = tripDate - now;
      const daysLeft = Math.ceil(diff / (1000 * 60 * 60 * 24));
      const weeksLeft = Math.floor(daysLeft / 7);
      const remainingDays = daysLeft % 7;

      let html = '';

      // HEADER
      html += `
        <div class="bg-white rounded-3xl p-5 shadow-lg mb-4">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-2xl font-bold text-gray-800">${trip.title}</h1>
              <p class="text-red-600 font-medium">${trip.subtitle}</p>
              <p class="text-gray-500 text-sm mt-1">${trip.dates} ‚Ä¢ ${trip.persons} personen ‚Ä¢ ${trip.duration}</p>
            </div>
            <a href="/" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </a>
          </div>
          <div class="flex flex-wrap gap-2 mt-3">
            ${daysLeft > 0 ? `
              <div class="inline-flex items-center gap-2 bg-gradient-to-r from-red-600 to-green-600 text-white px-4 py-1.5 rounded-full text-sm font-bold shadow-lg animate-pulse">
                üéÑ Nog ${weeksLeft > 0 ? weeksLeft + ' weken' + (remainingDays > 0 ? ' en ' + remainingDays + ' dagen' : '') : daysLeft + ' dagen'}!
              </div>
            ` : daysLeft === 0 ? `
              <div class="inline-flex items-center gap-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white px-4 py-1.5 rounded-full text-sm font-bold shadow-lg animate-pulse">
                üéâ VANDAAG IS HET ZOVER!
              </div>
            ` : `
              <div class="inline-flex items-center gap-2 bg-gray-500 text-white px-4 py-1.5 rounded-full text-sm font-bold">
                ‚úÖ Reis voltooid
              </div>
            `}
            ${weatherData ? `
              <div class="inline-flex items-center gap-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white px-3 py-1.5 rounded-full text-sm font-medium shadow">
                ${getWeatherEmoji(weatherData.current.weather_code)} ${Math.round(weatherData.current.temperature_2m)}¬∞C
                <span class="text-white/70 text-xs">nu in London</span>
              </div>
            ` : `
              <button onclick="fetchWeather()" class="inline-flex items-center gap-1 bg-cyan-100 text-cyan-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-cyan-200 transition">
                üå§Ô∏è Weer laden
              </button>
            `}
            <span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-sm">‚ùÑÔ∏è Winter Wonderland</span>
            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm">üé≠ West End</span>
          </div>
        </div>
      `;

      // TABS
      html += `<div class="flex gap-2 mb-4 overflow-x-auto hide-scrollbar">`;
      [
        { id: 'planning', label: 'üìÖ Planning' },
        { id: 'map', label: 'üó∫Ô∏è Kaart' },
        { id: 'budget', label: 'üí∞ Budget' },
        { id: 'checklist', label: `‚úÖ (${checkedCount}/${totalChecks})` },
        { id: 'packing', label: 'üéí Inpakken' },
        { id: 'photos', label: 'üì∏ Fotos' }
      ].forEach(t => {
        html += `<button onclick="setTab('${t.id}')" class="px-4 py-2 rounded-xl font-medium whitespace-nowrap shadow ${activeTab === t.id ? 'bg-red-600 text-white' : 'bg-white text-gray-700 hover:bg-red-50'}">${t.label}</button>`;
      });
      html += `</div>`;

      // PLANNING TAB
      if (activeTab === 'planning') {
        html += `<div class="flex gap-2 overflow-x-auto pb-3 hide-scrollbar">`;
        days.forEach(d => {
          html += `<button onclick="setDay(${d.day})" class="flex items-center gap-2 px-4 py-2 rounded-xl font-medium whitespace-nowrap shadow ${activeDay === d.day ? 'bg-red-600 text-white' : 'bg-white text-gray-700'}">${d.icon} Dag ${d.day}</button>`;
        });
        html += `</div>`;

        html += `
          <div class="bg-white rounded-2xl p-5 shadow-lg mb-4">
            <div class="flex items-center gap-4">
              <span class="text-5xl">${day.icon}</span>
              <div class="flex-1">
                <h2 class="text-2xl font-bold text-gray-800">Dag ${day.day}: ${day.title}</h2>
                <p class="text-gray-500">${day.date} ‚Ä¢ ${day.area}</p>
                <p class="text-red-600 font-semibold">${day.highlight}</p>
              </div>
              ${day.weather ? `
              <div class="text-center bg-gradient-to-br from-sky-100 to-blue-100 rounded-xl px-3 py-2 border border-sky-200">
                <div class="text-2xl">${day.weather.icon}</div>
                <div class="text-lg font-bold text-gray-800">${day.weather.high}¬∞</div>
                <div class="text-xs text-gray-500">nov gem</div>
              </div>
              ` : ''}
            </div>
            ${day.weather ? `
            <div class="mt-4 grid grid-cols-4 gap-2 text-center text-sm">
              <div class="bg-orange-50 rounded-lg p-2"><div class="text-orange-500">üå°Ô∏è Max</div><div class="font-bold">${day.weather.high}¬∞C</div></div>
              <div class="bg-blue-50 rounded-lg p-2"><div class="text-blue-500">üå°Ô∏è Min</div><div class="font-bold">${day.weather.low}¬∞C</div></div>
              <div class="bg-gray-50 rounded-lg p-2"><div class="text-gray-500">üåÖ Licht</div><div class="font-bold">8u</div></div>
              <div class="bg-cyan-50 rounded-lg p-2"><div class="text-cyan-600">üíß Regen</div><div class="font-bold">${day.weather.rain}%</div></div>
            </div>
            ${day.weather.note ? `<div class="mt-2 bg-amber-50 border border-amber-200 rounded-lg p-2 text-sm text-amber-700 text-center">${day.weather.note}</div>` : ''}
            <div class="mt-2 text-xs text-gray-400 text-center">üìä Historisch gemiddelde november</div>
            ` : ''}
            ${accom ? `<div class="mt-3 bg-red-50 rounded-xl p-3"><span class="text-xs text-red-600 font-bold">üè® ACCOMMODATIE</span><div class="font-bold text-red-800">${accom.name}</div></div>` : ''}
          </div>
        `;

        html += `<div class="bg-white rounded-2xl p-4 shadow-lg mb-4"><div class="space-y-2">`;
        acts.forEach((act, idx) => {
          const prevLoc = idx > 0 ? acts[idx-1].loc : (accom ? 'covent_garden' : null);
          const dist = prevLoc && act.loc ? calcDist(prevLoc, act.loc) : null;
          html += `
            <div onclick='openModal(${JSON.stringify(act).replace(/'/g, "\\'")})' class="rounded-xl p-3 cursor-pointer hover:shadow-md transition ${getTypeClass(act.type)}">
              <div class="flex items-center gap-3">
                <div class="font-mono font-bold text-gray-700 w-12 text-center">${act.time}</div>
                <div class="text-2xl">${act.icon}</div>
                <div class="flex-1 min-w-0">
                  <div class="font-bold text-gray-800">${act.title}</div>
                  <div class="text-gray-600 text-sm truncate">${act.subtitle}</div>
                </div>
                ${dist ? `<div class="text-xs bg-white/60 px-2 py-1 rounded-full hidden md:block">${dist}km</div>` : ''}
                <div class="text-gray-400">‚Üí</div>
              </div>
            </div>
          `;
        });
        html += `</div></div>`;

        // Day Notes
        html += `
          <div class="bg-gradient-to-r from-red-100 to-green-100 rounded-2xl p-4 shadow">
            <h4 class="font-bold text-red-800 mb-3">üìù Notities - Dag ${activeDay}</h4>
            <div class="flex gap-2 mb-3">
              <input type="text" id="dayNoteInput" placeholder="Schrijf notitie..." class="flex-1 px-4 py-2 rounded-xl border text-sm">
              <button onclick="saveNote()" class="bg-red-600 text-white px-4 py-2 rounded-xl font-medium">+</button>
            </div>
            ${(dayNotes[activeDay] || []).length > 0 ? `<div class="space-y-2">${(dayNotes[activeDay] || []).map(n => `
              <div class="bg-white rounded-lg p-3 flex justify-between">
                <div><p class="text-gray-800">${n.text}</p><p class="text-xs text-gray-400">${n.ts}</p></div>
                <button onclick="deleteNote(${n.id})" class="text-red-400 hover:text-red-600">√ó</button>
              </div>
            `).join('')}</div>` : ''}
          </div>
        `;
      }

      // MAP TAB
      if (activeTab === 'map') {
        const dayLocs = acts.filter(a => a.loc && locations[a.loc]).map(a => ({ ...a, ...locations[a.loc] }));
        
        html += `<div class="flex gap-2 overflow-x-auto pb-3 hide-scrollbar mb-4">`;
        days.forEach(d => {
          html += `<button onclick="setDay(${d.day}); setTab('map');" class="flex items-center gap-2 px-4 py-2 rounded-xl font-medium whitespace-nowrap shadow ${activeDay === d.day ? 'bg-red-600 text-white' : 'bg-white text-gray-700'}">${d.icon} Dag ${d.day}</button>`;
        });
        html += `</div>`;

        html += `
          <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
            <div class="p-4 bg-gradient-to-r from-red-600 to-green-600 text-white">
              <h3 class="font-bold text-lg">üó∫Ô∏è Dag ${activeDay}: ${day.title}</h3>
              <p class="text-white/80 text-sm">${dayLocs.length} locaties</p>
            </div>
            <div class="p-4 space-y-2">
              ${dayLocs.map((loc, i) => `
                <a href="${getMapsUrl(loc.loc)}" target="_blank" class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl hover:bg-red-50 transition">
                  <div class="w-8 h-8 rounded-full bg-red-600 text-white flex items-center justify-center font-bold text-sm">${i+1}</div>
                  <span class="text-2xl">${loc.icon}</span>
                  <div class="flex-1"><div class="font-medium text-gray-800">${loc.title}</div><div class="text-sm text-gray-500">${loc.time}</div></div>
                  <span class="text-red-500">üìç</span>
                </a>
              `).join('')}
            </div>
            ${dayLocs.length > 1 ? `
              <div class="p-4 bg-red-50 border-t">
                <a href="https://www.google.com/maps/dir/${dayLocs.map(l => `${l.lat},${l.lng}`).join('/')}" target="_blank" class="block w-full bg-red-600 text-white text-center py-3 rounded-xl font-bold">üó∫Ô∏è Open volledige route</a>
              </div>
            ` : ''}
          </div>
        `;
      }

      // BUDGET TAB
      if (activeTab === 'budget') {
        html += `
          <div class="space-y-4">
            <div class="bg-gradient-to-r from-red-600 to-green-600 rounded-2xl p-5 text-white shadow-lg">
              <h3 class="font-bold text-lg mb-3">üí∏ Uitgaven Tracker</h3>
              <div class="grid grid-cols-3 gap-2 mb-3">
                <input type="text" id="expenseDesc" placeholder="Omschrijving" class="col-span-2 px-3 py-2 rounded-lg text-gray-800 text-sm">
                <input type="number" id="expenseAmount" placeholder="‚Ç¨" step="0.01" class="px-3 py-2 rounded-lg text-gray-800 text-sm">
              </div>
              <div class="flex gap-2">
                <select id="expenseCategory" class="flex-1 px-3 py-2 rounded-lg text-gray-800 text-sm">
                  <option>üçΩÔ∏è Eten</option><option>üöó Vervoer</option><option>üé´ Activiteit</option><option>üéÅ Shopping</option><option>üí∞ Overig</option>
                </select>
                <button onclick="addExpense()" class="bg-white text-red-600 px-4 py-2 rounded-lg font-bold">+</button>
              </div>
              ${expenses.length > 0 ? `<div class="mt-4 pt-4 border-t border-white/30 flex justify-between"><span>Totaal uitgegeven:</span><span class="text-2xl font-bold">‚Ç¨${totalExpenses.toFixed(2)}</span></div>` : ''}
            </div>

            ${expenses.length > 0 ? `
              <div class="bg-white rounded-2xl p-4 shadow-lg">
                <h3 class="font-bold text-gray-800 mb-3">üìù Uitgaven</h3>
                <div class="space-y-2 max-h-48 overflow-y-auto">
                  ${expenses.slice().reverse().map(e => `
                    <div class="flex justify-between items-center py-2 px-3 bg-gray-50 rounded-lg">
                      <div><span class="text-sm text-gray-500">${e.category}</span> <span class="font-medium text-gray-800">${e.desc}</span></div>
                      <div class="flex items-center gap-2">
                        <span class="font-bold text-red-600">‚Ç¨${e.amount.toFixed(2)}</span>
                        <button onclick="deleteExpense(${e.id})" class="text-gray-400 hover:text-red-500">√ó</button>
                      </div>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}

            <div class="bg-white rounded-2xl p-4 shadow-lg">
              <h3 class="font-bold text-gray-800 mb-3">üìä Geschatte Kosten</h3>
              <div class="space-y-1 max-h-64 overflow-y-auto">
                ${budget.estimated.map(i => `
                  <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="text-sm text-gray-700">${i.item}</span>
                    <span class="font-mono text-sm text-gray-600">‚Ç¨${i.budget} | ‚Ç¨${i.comfort}</span>
                  </div>
                `).join('')}
              </div>
              <div class="mt-3 pt-3 border-t-2 border-red-200 flex justify-between font-bold">
                <span class="text-gray-800">TOTAAL</span>
                <span class="text-gray-800">‚Ç¨${estBudget} | ‚Ç¨${estComfort}</span>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div class="bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl p-4 text-white text-center">
                <div class="text-sm opacity-80">üíö Budget</div>
                <div class="text-3xl font-bold">‚Ç¨${estBudget}</div>
                <div class="text-sm opacity-80">‚Ç¨${Math.round(estBudget/2)} p.p.</div>
              </div>
              <div class="bg-gradient-to-br from-red-500 to-rose-600 rounded-2xl p-4 text-white text-center">
                <div class="text-sm opacity-80">‚ú® Comfort</div>
                <div class="text-3xl font-bold">‚Ç¨${estComfort}</div>
                <div class="text-sm opacity-80">‚Ç¨${Math.round(estComfort/2)} p.p.</div>
              </div>
            </div>
          </div>
        `;
      }

      // CHECKLIST TAB
      if (activeTab === 'checklist') {
        html += `<div class="space-y-4">`;
        checklistSections.forEach(sec => {
          const secChecked = sec.items.filter(i => checklist[i.key]).length;
          html += `
            <div class="bg-white rounded-2xl p-4 shadow-lg">
              <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">${sec.title} <span class="text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full">${secChecked}/${sec.items.length}</span></h3>
              <div class="space-y-2">
                ${sec.items.map(i => `
                  <label class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg cursor-pointer">
                    <input type="checkbox" ${checklist[i.key] ? 'checked' : ''} onchange="toggleCheck('${i.key}')" class="w-5 h-5 rounded text-red-600">
                    <span class="${checklist[i.key] ? 'line-through text-gray-400' : 'text-gray-700'}">${i.label}</span>
                  </label>
                `).join('')}
              </div>
            </div>
          `;
        });
        html += `
          <div class="bg-gradient-to-r from-red-600 to-green-600 rounded-2xl p-5 text-white">
            <h3 class="font-bold mb-3">üìä Voortgang</h3>
            <div class="bg-white/20 rounded-full h-4 mb-2">
              <div class="bg-white rounded-full h-4 transition-all" style="width: ${Math.max((checkedCount/totalChecks)*100, 5)}%"></div>
            </div>
            <div class="text-center">${checkedCount} / ${totalChecks} items</div>
          </div>
        </div>`;
      }

      // PACKING TAB
      if (activeTab === 'packing') {
        const packingChecked = Object.keys(packingList).filter(k => packingList[k]).length;
        const packingTotal = Object.values(packingCategories).reduce((sum, cat) => sum + cat.items.length, 0);
        
        html += `
          <div class="space-y-4">
            <div class="bg-gradient-to-r from-red-600 to-green-600 rounded-2xl p-5 text-white">
              <h2 class="text-xl font-bold mb-2">üéí Slimme Inpaklijst</h2>
              <p class="text-white/80 text-sm">Automatisch gegenereerd voor je London Christmas trip!</p>
              <div class="mt-3 flex items-center gap-3">
                <div class="flex-1 bg-white/20 rounded-full h-3">
                  <div class="bg-white rounded-full h-3 transition-all" style="width: ${Math.max((packingChecked/packingTotal)*100, 3)}%"></div>
                </div>
                <span class="font-bold">${packingChecked}/${packingTotal}</span>
              </div>
            </div>
            
            ${Object.entries(packingCategories).map(([key, cat]) => `
              <div class="bg-white rounded-2xl p-5 shadow-lg">
                <h3 class="font-bold mb-3 text-lg">${cat.title}</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                  ${cat.items.map((item, idx) => {
                    const itemKey = key + '_' + idx;
                    return `
                      <label class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg cursor-pointer">
                        <input type="checkbox" ${packingList[itemKey] ? 'checked' : ''} onchange="togglePacking('${itemKey}')" class="w-5 h-5 rounded text-red-600">
                        <span class="${packingList[itemKey] ? 'line-through text-gray-400' : 'text-gray-700'}">${item}</span>
                      </label>
                    `;
                  }).join('')}
                </div>
              </div>
            `).join('')}
            
            <div class="bg-blue-50 border border-blue-200 rounded-2xl p-4 text-sm text-blue-800">
              <strong>üí° London Tip:</strong> November is koud & nat! Neem zeker een paraplu en waterdichte schoenen mee. UK stekker adapter niet vergeten!
            </div>
          </div>`;
      }

      // PHOTOS TAB
      if (activeTab === 'photos') {
        const totalPhotos = Object.values(tripPhotos).flat().length;
        html += `
          <div class="space-y-4">
            <div class="bg-gradient-to-r from-red-600 to-green-600 rounded-2xl p-5 text-white">
              <h2 class="text-xl font-bold mb-2">üì∏ Foto Galerij</h2>
              <p class="text-white/80 text-sm">Voeg foto's toe per dag van je London Christmas trip!</p>
              <div class="mt-2 text-lg font-bold">${totalPhotos} foto's opgeslagen</div>
            </div>
            
            ${days.map(d => `
              <div class="bg-white rounded-2xl p-5 shadow-lg">
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center gap-3">
                    <span class="text-3xl">${d.icon}</span>
                    <div>
                      <h3 class="font-bold text-gray-800">Dag ${d.day}: ${d.title}</h3>
                      <p class="text-sm text-gray-500">${d.date}</p>
                    </div>
                  </div>
                  <button onclick="addPhoto(${d.day})" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-xl font-medium transition">
                    + Foto
                  </button>
                </div>
                ${tripPhotos[d.day] && tripPhotos[d.day].length > 0 ? `
                  <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                    ${tripPhotos[d.day].map((photo, idx) => `
                      <div class="relative group">
                        <img src="${photo.src}" alt="Dag ${d.day} foto" class="w-full h-32 object-cover rounded-xl">
                        <button onclick="deletePhoto(${d.day}, ${idx})" class="absolute top-2 right-2 bg-red-500 text-white w-6 h-6 rounded-full opacity-0 group-hover:opacity-100 transition text-sm">√ó</button>
                      </div>
                    `).join('')}
                  </div>
                ` : `
                  <div class="bg-gray-50 rounded-xl p-6 text-center text-gray-400">
                    <div class="text-3xl mb-2">üì∑</div>
                    <p>Nog geen foto's voor deze dag</p>
                  </div>
                `}
              </div>
            `).join('')}
          </div>
        `;
      }

      // MODAL
      if (selectedModal) {
        const m = selectedModal;
        const info = m.info || {};
        const dist = m.loc && accom ? calcDist('covent_garden', m.loc) : null;

        html += `
          <div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50" onclick="closeModal()">
            <div class="bg-white rounded-3xl max-w-lg w-full max-h-[85vh] overflow-y-auto shadow-2xl" onclick="event.stopPropagation()">
              <div class="p-5 ${getTypeClass(m.type)} rounded-t-3xl">
                <div class="flex justify-between items-start">
                  <div class="flex items-center gap-3">
                    <span class="text-4xl">${m.icon}</span>
                    <div>
                      <h3 class="text-xl font-bold text-gray-800">${m.title}</h3>
                      <p class="text-gray-600">${m.time} ‚Ä¢ ${m.subtitle}</p>
                    </div>
                  </div>
                  <button onclick="closeModal()" class="text-3xl text-gray-400 hover:text-gray-600">√ó</button>
                </div>
              </div>
              <div class="p-5 space-y-4">
                ${dist ? `
                  <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-4">
                    <h4 class="font-bold text-blue-800 mb-2">üìç Afstanden</h4>
                    <div class="bg-white p-3 rounded-xl shadow-sm">
                      <div class="text-gray-500 text-xs">Vanaf accommodatie</div>
                      <div class="font-bold text-blue-700 text-lg">${dist} km</div>
                      <div class="text-xs text-gray-500">${estTime(dist)}</div>
                    </div>
                  </div>
                ` : ''}
                ${info.desc ? `<div><h4 class="font-bold text-gray-700 mb-1">üìñ Beschrijving</h4><p class="text-gray-600">${info.desc}</p></div>` : ''}
                ${info.highlights ? `<div><h4 class="font-bold text-gray-700 mb-2">‚ú® Highlights</h4><div class="flex flex-wrap gap-2">${info.highlights.map(h => `<span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm">${h}</span>`).join('')}</div></div>` : ''}
                ${info.price ? `<div class="bg-green-50 p-4 rounded-xl"><h4 class="font-bold text-green-800 mb-1">üí∞ Kosten</h4><p class="text-green-700 font-semibold text-lg">${info.price}</p></div>` : ''}
                ${info.duration ? `<div class="flex items-center gap-2 bg-gray-50 p-3 rounded-xl"><span>‚è±Ô∏è</span><strong>Duur:</strong> ${info.duration}</div>` : ''}
                ${info.tips ? `<div><h4 class="font-bold text-gray-700 mb-2">üí° Tips</h4><ul class="space-y-1">${info.tips.map(t => `<li class="text-sm bg-blue-50 text-blue-800 p-2 rounded-lg">‚Ä¢ ${t}</li>`).join('')}</ul></div>` : ''}
                ${info.mustTry ? `<div><h4 class="font-bold text-gray-700 mb-2">üç¥ Must Try</h4><div class="flex flex-wrap gap-2">${info.mustTry.map(t => `<span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm">${t}</span>`).join('')}</div></div>` : ''}
                ${info.recommendations ? `<div><h4 class="font-bold text-gray-700 mb-2">üé≠ Aanbevelingen</h4><div class="flex flex-wrap gap-2">${info.recommendations.map(r => `<span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm">${r}</span>`).join('')}</div></div>` : ''}
                ${info.warning ? `<div class="bg-red-50 border border-red-200 p-4 rounded-xl"><h4 class="font-bold text-red-800 mb-1">‚ö†Ô∏è Let op!</h4><p class="text-red-700">${info.warning}</p></div>` : ''}
                ${info.mustSee ? `<div class="bg-gradient-to-r from-red-100 to-green-100 p-4 rounded-xl text-center"><span class="text-2xl">‚≠ê</span><span class="font-bold text-gray-800 ml-2">MUST SEE / DO!</span></div>` : ''}
                ${info.website ? `<a href="https://${info.website}" target="_blank" rel="noopener" class="block w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white text-center py-3 px-4 rounded-xl font-semibold hover:from-green-600 hover:to-emerald-700 transition-all shadow-lg mb-2">üé´ Boek nu op ${info.website}</a>` : ''}
                ${m.loc && getMapsUrl(m.loc) ? `<a href="${getMapsUrl(m.loc)}" target="_blank" class="block w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white text-center py-3 px-4 rounded-xl font-semibold">üìç Open in Google Maps</a>` : ''}
              </div>
            </div>
          </div>
        `;
      }

      // FOOTER
      html += `
        <div class="mt-6 space-y-3 text-center">
          <div class="flex flex-wrap justify-center gap-2">
            <button onclick="shareTrip()" class="bg-gradient-to-r from-red-500 to-green-500 text-white px-4 py-2 rounded-xl font-bold shadow">üîó Deel</button>
            <button onclick="exportTrip()" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-xl font-bold shadow">üìÑ Export</button>
            <button onclick="toggleDarkMode()" class="bg-gradient-to-r from-gray-600 to-gray-800 text-white px-4 py-2 rounded-xl font-bold shadow">${darkMode ? '‚òÄÔ∏è Light' : 'üåô Dark'}</button>
          </div>
          <p class="text-white/80 text-sm">üéÑ London Christmas 2026 üéÑ</p>
          <a href="/" class="text-white hover:underline text-sm">‚Üê Terug naar overzicht</a>
        </div>
      `;

      document.getElementById('app').innerHTML = html;
    }

    render();
  </script>
</body>
</html>
