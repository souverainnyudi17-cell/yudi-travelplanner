<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ”ï¸ Montenegro Adventure 2026</title>
  <meta name="theme-color" content="#d97706">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icon-192.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    body.dark { background: linear-gradient(135deg, #1e293b, #0f172a) !important; }
    body.dark .bg-white { background: #1e293b !important; }
    body.dark .text-gray-800, body.dark .text-gray-700 { color: #f1f5f9 !important; }
    body.dark .text-gray-600, body.dark .text-gray-500 { color: #94a3b8 !important; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-100 via-stone-50 to-amber-50">
  <div id="app" class="max-w-2xl mx-auto p-4 pb-8"></div>

  <script>
    // ============================================
    // MONTENEGRO ADVENTURE 2026 - COMPLETE VERSION
    // ============================================

    let activeDay = 1;
    let activeTab = 'planning';
    let selectedModal = null;
    let checklist = JSON.parse(localStorage.getItem('montenegroChecklist') || '{}');
    let packingList = JSON.parse(localStorage.getItem('montenegroPackingList') || '{}');

    // Auto-generated packing list for Montenegro
    const packingCategories = {
      documents: { title: 'ğŸ“„ Documenten', items: ['Paspoort / ID-kaart', 'Rijbewijs', 'Creditcard', 'EHIC / Zorgpas', 'Bevestigingen (print/digitaal)', 'Reisverzekering documenten'] },
      bergen: { title: 'ğŸ§¥ Bergen & Durmitor (koud!)', items: ['Winterjas / fleece', 'Lange broek (wandelen)', 'Wandelschoenen!', 'Handschoenen (ochtend)', 'Muts / sjaal', 'Regenjas'] },
      rafting: { title: 'ğŸš£ Tara Rafting Dag', items: ['Zwemkleding (onder kleding!)', 'Sportschoenen', 'Waterproof camera', 'Handdoek', 'Droge kleding voor na'] },
      strand: { title: 'ğŸ–ï¸ Budva Kust', items: ['Zwemkleding (2x)', 'Badhanddoek', 'Zonnebrand SPF50', 'Zonnebril', 'Slippers', 'Waterproof telefoonhoesje'] },
      algemeen: { title: 'ğŸ‘• Algemene Kleding', items: ['T-shirts (6x)', 'Shorts (3x)', 'Lange broek (2x)', 'Ondergoed (9x)', 'Sokken (9x)', 'Pyjama', 'Nette outfit (diner)'] },
      tech: { title: 'ğŸ“± Elektronica', items: ['Telefoon + oplader', 'Powerbank', 'Camera + oplader', 'Koptelefoon', 'EU stekker (standaard)'] },
      toilettas: { title: 'ğŸ§´ Toilettas', items: ['Tandenborstel & tandpasta', 'Deodorant', 'Shampoo / douchegel', 'Medicijnen (persoonlijk)', 'Aftersun', 'Lippenbalsem SPF'] }
    };
    let expenses = JSON.parse(localStorage.getItem('montenegroExpenses') || '[]');
    let dayNotes = JSON.parse(localStorage.getItem('montenegroDayNotes') || '{}');
    let darkMode = localStorage.getItem('montenegroDarkMode') === 'true';
    let weatherData = null;
    let weatherLoading = false;

    // Weather coordinates for Montenegro
    const weatherLocations = {
      kotor: { lat: 42.42, lon: 18.77, name: 'Kotor' },
      budva: { lat: 42.29, lon: 18.84, name: 'Budva' }
    };

    // Fetch current weather
    async function fetchWeather() {
      if (weatherLoading || weatherData) return;
      weatherLoading = true;
      try {
        const loc = weatherLocations.kotor;
        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${loc.lat}&longitude=${loc.lon}&current=temperature_2m,weather_code,wind_speed_10m&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=auto&forecast_days=3`);
        weatherData = await res.json();
        render();
      } catch (e) { console.log('Weather fetch failed:', e); }
      weatherLoading = false;
    }

    // Weather code to emoji
    function getWeatherEmoji(code) {
      if (code <= 3) return 'â˜€ï¸';
      if (code <= 48) return 'â˜ï¸';
      if (code <= 67) return 'ğŸŒ§ï¸';
      if (code <= 77) return 'ğŸŒ¨ï¸';
      if (code <= 82) return 'ğŸŒ§ï¸';
      if (code >= 95) return 'â›ˆï¸';
      return 'ğŸŒ¤ï¸';
    }

    const trip = {
      title: 'ğŸ”ï¸ Montenegro Adventure',
      subtitle: 'Bergen, Canyon & Kust',
      dates: '16-24 mei 2026',
      duration: '9 dagen',
      persons: 2
    };

    const accommodations = {
      kotor: { name: 'Appartement Kotor Old Town', area: 'Kotor Old Town / Dobrota', dates: '16-19 mei', nights: 3, price: 195, lat: 42.4247, lng: 18.7712 },
      durmitor: { name: 'Mountain Lodge Å½abljak', area: 'Å½abljak, Durmitor', dates: '19-21 mei', nights: 2, price: 100, lat: 43.1556, lng: 19.1228 },
      budva: { name: 'Beach Apartment Budva', area: 'Budva Riviera', dates: '21-24 mei', nights: 3, price: 210, lat: 42.2864, lng: 18.8400 }
    };

    const locations = {
      tivat: { lat: 42.4047, lng: 18.7233 },
      kotor: { lat: 42.4247, lng: 18.7712 },
      kotor_fortress: { lat: 42.4280, lng: 18.7720 },
      perast: { lat: 42.4867, lng: 18.6983 },
      our_lady: { lat: 42.4870, lng: 18.6910 },
      lovcen: { lat: 42.3994, lng: 18.8389 },
      cetinje: { lat: 42.3903, lng: 18.9233 },
      njegos: { lat: 42.3994, lng: 18.8389 },
      ostrog: { lat: 42.6747, lng: 19.0297 },
      zabljak: { lat: 43.1556, lng: 19.1228 },
      black_lake: { lat: 43.1453, lng: 19.0967 },
      tara_bridge: { lat: 43.1500, lng: 19.2833 },
      tara_canyon: { lat: 43.1167, lng: 19.3500 },
      budva: { lat: 42.2864, lng: 18.8400 },
      sveti_stefan: { lat: 42.2569, lng: 18.8903 },
      mogren: { lat: 42.2903, lng: 18.8333 },
      jaz: { lat: 42.2917, lng: 18.8083 },
      blue_cave: { lat: 42.3833, lng: 18.7167 },
      skadar: { lat: 42.2167, lng: 19.1000 },
      virpazar: { lat: 42.2417, lng: 19.0917 }
    };

    function calcDist(loc1, loc2) {
      if (!locations[loc1] || !locations[loc2]) return null;
      const R = 6371;
      const l1 = locations[loc1], l2 = locations[loc2];
      const dLat = (l2.lat - l1.lat) * Math.PI / 180;
      const dLon = (l2.lng - l1.lng) * Math.PI / 180;
      const a = Math.sin(dLat/2)**2 + Math.cos(l1.lat * Math.PI/180) * Math.cos(l2.lat * Math.PI/180) * Math.sin(dLon/2)**2;
      return Math.round(R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
    }

    function estTime(km) {
      if (!km) return '';
      const m = Math.round((km / 40) * 60);
      return m < 60 ? `~${m} min` : `~${Math.floor(m/60)}u${m%60 > 0 ? ` ${m%60}min` : ''}`;
    }

    function getMapsUrl(loc) {
      if (!locations[loc]) return null;
      return `https://www.google.com/maps/search/?api=1&query=${locations[loc].lat},${locations[loc].lng}`;
    }

    const days = [
      { day: 1, date: 'Za 16 mei', title: 'Aankomst Kotor', icon: 'âœˆï¸', region: 'Kotor', highlight: 'Old Town verkennen', accom: 'kotor', weather: { high: 24, low: 15, icon: 'â˜€ï¸', rain: 10 } },
      { day: 2, date: 'Zo 17 mei', title: 'Bay of Kotor', icon: 'â›µ', region: 'Kotor', highlight: 'Boottrip + Perast', accom: 'kotor', weather: { high: 24, low: 15, icon: 'â˜€ï¸', rain: 10 } },
      { day: 3, date: 'Ma 18 mei', title: 'LovÄ‡en & Cetinje', icon: 'ğŸ”ï¸', region: 'Bergen', highlight: 'Bergpanorama', accom: 'kotor', weather: { high: 18, low: 10, icon: 'ğŸŒ¤ï¸', rain: 15, note: 'ğŸ§¥ Bergen: 10-15Â°C kouder!' } },
      { day: 4, date: 'Di 19 mei', title: 'Naar Durmitor', icon: 'ğŸš—', region: 'Bergen', highlight: 'Ostrog + Black Lake', accom: 'durmitor', featured: true, weather: { high: 16, low: 6, icon: 'ğŸŒ¤ï¸', rain: 20, note: 'ğŸ§¥ Durmitor: koel & fris!' } },
      { day: 5, date: 'Wo 20 mei', title: 'Tara Rafting!', icon: 'ğŸš£', region: 'Durmitor', highlight: 'Diepste canyon Europa!', accom: 'durmitor', featured: true, weather: { high: 17, low: 7, icon: 'â˜€ï¸', rain: 15, note: 'ğŸ’§ Rivierwater: 12Â°C!' } },
      { day: 6, date: 'Do 21 mei', title: 'Naar Budva', icon: 'ğŸ–ï¸', region: 'Kust', highlight: 'Sveti Stefan', accom: 'budva', weather: { high: 25, low: 16, icon: 'â˜€ï¸', rain: 10 } },
      { day: 7, date: 'Vr 22 mei', title: 'Watersport Dag!', icon: 'ğŸš€', region: 'Budva', highlight: 'Jetski + Parasailing', accom: 'budva', featured: true, weather: { high: 25, low: 17, icon: 'â˜€ï¸', rain: 5, note: 'ğŸŒŠ Perfect strandweer!' } },
      { day: 8, date: 'Za 23 mei', title: 'Skadar Lake', icon: 'ğŸ¦…', region: 'Budva', highlight: 'Vogelparadijs + Wijn', accom: 'budva', weather: { high: 26, low: 17, icon: 'â˜€ï¸', rain: 10 } },
      { day: 9, date: 'Zo 24 mei', title: 'Vertrek', icon: 'ğŸ ', region: 'Terug', highlight: 'Afscheid Montenegro', accom: 'budva', weather: { high: 25, low: 16, icon: 'â˜€ï¸', rain: 10 } }
    ];

    const activities = {
      1: [
        { time: '11:00', title: 'Vertrek Amsterdam', subtitle: 'Vlucht via overstap', icon: 'âœˆï¸', type: 'transport', loc: 'tivat', info: { desc: 'Vlucht Amsterdam â†’ Tivat', tips: ['2 uur voor vertrek', 'Online inchecken'], duration: '~3.5u totaal' }},
        { time: '14:30', title: 'Landing Tivat', subtitle: 'Kleine luchthaven', icon: 'ğŸ›¬', type: 'transport', loc: 'tivat', info: { tips: ['Paspoort klaar', 'Kleine airport = snel door'] }},
        { time: '15:00', title: 'Auto ophalen', subtitle: 'Huurauto klaar', icon: 'ğŸš—', type: 'transport', loc: 'tivat', info: { tips: ['Creditcard verplicht', 'Check op schade + fotos'], price: '~â‚¬25-35/dag' }},
        { time: '15:45', title: 'Check-in Kotor', subtitle: 'Appartement Old Town', icon: 'ğŸ ', type: 'accommodation', loc: 'kotor', info: { price: 'â‚¬195 totaal (3 nachten)', desc: 'Appartement in of nabij de oude stad' }},
        { time: '17:00', title: 'â­ Kotor Old Town', subtitle: 'UNESCO Werelderfgoed', icon: 'ğŸ°', type: 'highlight', loc: 'kotor', info: { desc: 'Middeleeuwse ommuurde stad - spectaculair!', highlights: ['Sea Gate', 'Clock Tower', 'St. Tryphon Cathedral', 'Cats Museum'], tips: ['Verdwaal in de steegjes!', 'Veel katten ğŸ±', 'Gratis toegang'], duration: '2-3 uur', mustSee: true }},
        { time: '19:00', title: 'Fortress Climb', subtitle: '1350 treden!', icon: 'ğŸ¥¾', type: 'activity', loc: 'kotor_fortress', info: { desc: 'Beklim naar San Giovanni Fortress voor spectaculair uitzicht', tips: ['Voor zonsondergang beginnen!', 'Water meenemen', 'â‚¬8 entree overdag, gratis na 20:00'], duration: '1-1.5 uur', price: 'â‚¬8 p.p.', mustSee: true }},
        { time: '21:00', title: 'Diner Old Town', subtitle: 'Lokale keuken', icon: 'ğŸ½ï¸', type: 'food', loc: 'kotor', info: { recommendations: ['Galion', 'Bastion', 'Cesarica'], mustTry: ['Ä†evapi', 'Zwarte risotto', 'NjeguÅ¡ki prÅ¡ut'], price: 'â‚¬15-25 p.p.' }}
      ],
      2: [
        { time: '09:30', title: 'â­ Bay of Kotor Boottocht', subtitle: 'Hele baai per boot', icon: 'â›µ', type: 'highlight', loc: 'kotor', info: { desc: 'Spectaculaire Bay of Kotor tour - fjord-achtig landschap!', highlights: ['Perast bezoeken', 'Our Lady of the Rocks', 'Blue Cave zwemmen'], tips: ['Boek vooraf of op de kade', 'Zonnebrand mee!'], price: 'â‚¬25-40 p.p.', duration: '3-4 uur', website: 'viator.com', mustSee: true }},
        { time: '10:30', title: 'Our Lady of the Rocks', subtitle: 'Kunstmatig eiland', icon: 'â›ª', type: 'activity', loc: 'our_lady', info: { desc: 'Klein eiland met 17e-eeuwse kerk', tips: ['Onderdeel van boottocht', 'Museum binnenin'], duration: '30 min' }},
        { time: '11:30', title: 'Perast', subtitle: 'Barok dorpje', icon: 'ğŸ˜ï¸', type: 'activity', loc: 'perast', info: { desc: 'Pittoresk barok stadje aan de baai', highlights: ['St. Nicholas Church toren beklimmen', 'Waterkant paleizen', 'Authentieke sfeer'], tips: ['Minder toeristisch dan Kotor'], mustSee: true }},
        { time: '13:00', title: 'Lunch Perast', subtitle: 'Verse vis aan zee', icon: 'ğŸ½ï¸', type: 'food', loc: 'perast', info: { mustTry: ['Gegrilde vis', 'Mosselen', 'Octopus salade'], price: 'â‚¬12-20 p.p.', tips: ['Terrassen aan het water'] }},
        { time: '15:00', title: 'Blue Cave', subtitle: 'Zwemmen in blauwe grot', icon: 'ğŸŠ', type: 'highlight', loc: 'blue_cave', info: { desc: 'Zeegrot met spectaculair blauw licht', tips: ['Zwemmen mogelijk!', 'Snorkelset meenemen', 'Vaak onderdeel boottocht'], mustSee: true }},
        { time: '20:00', title: 'Diner Kotor', subtitle: 'Seafood avond', icon: 'ğŸ½ï¸', type: 'food', loc: 'kotor', info: { price: 'â‚¬20-30 p.p.' }}
      ],
      3: [
        { time: '08:30', title: 'Vertrek naar LovÄ‡en', subtitle: '25 haarspeldbochten!', icon: 'ğŸš—', type: 'transport', loc: 'lovcen', info: { desc: 'Spectaculaire bergweg met 25 tornanti!', warning: 'Smalle weg, steile afgronden - rustig rijden!', duration: '1-1.5 uur' }},
        { time: '10:00', title: 'â­ NjegoÅ¡ Mausoleum', subtitle: '461 treden naar de top', icon: 'ğŸ›ï¸', type: 'highlight', loc: 'njegos', info: { desc: 'Mausoleum op 1657m hoogte met 360Â° uitzicht', tips: ['461 treden door tunnel', 'Jas meenemen - koud!', 'Helder weer = je ziet ItaliÃ«'], price: 'â‚¬5 p.p.', duration: '1-1.5 uur', mustSee: true }},
        { time: '12:00', title: 'LovÄ‡en Nationaal Park', subtitle: 'Panorama wandeling', icon: 'ğŸŒ²', type: 'activity', loc: 'lovcen', info: { tips: ['Korte wandelingen mogelijk', 'Picknicken met uitzicht'] }},
        { time: '13:30', title: 'Lunch NjeguÅ¡i', subtitle: 'PrÅ¡ut & kaas dorp', icon: 'ğŸ½ï¸', type: 'food', loc: 'lovcen', info: { desc: 'Beroemd om gerookte ham en kaas!', mustTry: ['NjeguÅ¡ki prÅ¡ut (ham)', 'NjeguÅ¡ki sir (kaas)', 'Lokale wijn'], price: 'â‚¬10-15 p.p.', mustSee: true }},
        { time: '15:00', title: 'Cetinje', subtitle: 'Oude koninklijke hoofdstad', icon: 'ğŸ°', type: 'activity', loc: 'cetinje', info: { desc: 'Historische hoofdstad van Montenegro', highlights: ['Cetinje Monastery', 'King Nikola Museum', 'Oude ambassades'], duration: '1-2 uur' }},
        { time: '20:00', title: 'Diner Kotor', subtitle: 'Laatste avond Kotor', icon: 'ğŸ½ï¸', type: 'food', loc: 'kotor', info: { price: 'â‚¬15-25 p.p.' }}
      ],
      4: [
        { time: '08:00', title: 'Check-out Kotor', subtitle: 'Naar de bergen!', icon: 'ğŸ“¦', type: 'accommodation', loc: 'kotor', info: { tips: ['Water & snacks meenemen', 'Volle tank tanken'] }},
        { time: '10:30', title: 'â­ Ostrog Monastery', subtitle: 'In rotswand gebouwd!', icon: 'â›ª', type: 'highlight', loc: 'ostrog', info: { desc: 'Spectaculair klooster uitgehakt in rotswand - belangrijkste bedevaartsoord Balkan!', highlights: ['Upper Monastery (in de rots)', 'RelikwieÃ«n St. Basil', 'Prachtige berglocatie'], tips: ['KnieÃ«n/schouders bedekken', 'Gratis entree', 'Respecteer religieuze sfeer'], warning: 'Steile smalle weg naar boven!', mustSee: true }},
        { time: '12:30', title: 'Lunch onderweg', subtitle: 'Lokaal restaurant', icon: 'ğŸ½ï¸', type: 'food', loc: 'ostrog', info: { mustTry: ['KaÄamak (polenta)', 'Ä†evapi', 'Kajmak'], price: 'â‚¬8-15 p.p.' }},
        { time: '16:30', title: 'Check-in Å½abljak', subtitle: 'Mountain Lodge', icon: 'ğŸ ', type: 'accommodation', loc: 'zabljak', info: { price: 'â‚¬100 totaal (2 nachten)', desc: 'Bergverblijf nabij Durmitor NP' }},
        { time: '17:30', title: 'â­ Black Lake', subtitle: 'Wandeling rond bergmeer', icon: 'ğŸ”ï¸', type: 'highlight', loc: 'black_lake', info: { desc: '"Crno Jezero" - Oog van de Berg - prachtig bergmeer!', tips: ['3.5 km wandeling rondom', 'Makkelijk pad', 'Perfect voor zonsondergang!'], price: 'â‚¬3 parkentree', duration: '1-1.5 uur', mustSee: true }},
        { time: '20:00', title: 'Bergdiner', subtitle: 'Hearty mountain food', icon: 'ğŸ½ï¸', type: 'food', loc: 'zabljak', info: { mustTry: ['Lamsvlees', 'KaÄamak', 'Cicvara'], price: 'â‚¬10-18 p.p.' }}
      ],
      5: [
        { time: '06:00', title: 'âš ï¸ VROEG opstaan!', subtitle: 'Rafting pickup', icon: 'â°', type: 'warning', loc: 'zabljak', info: { warning: 'Vroege pickup voor rafting!' }},
        { time: '08:30', title: 'Ontbijt rafting kamp', subtitle: 'Traditioneel ontbijt', icon: 'ğŸ³', type: 'food', loc: 'tara_canyon', info: { desc: 'Ontbijt bij het rafting basiskamp', price: 'Inbegrepen' }},
        { time: '10:00', title: 'â­ TARA RIVER RAFTING!', subtitle: '2e diepste canyon ter wereld!', icon: 'ğŸš£', type: 'highlight', loc: 'tara_canyon', info: { desc: 'Raft door de 2e diepste canyon van de wereld - na Grand Canyon!', highlights: ['18 km route', 'Kristalhelder water', '50+ stroomversnellingen', 'Watervallen', '1300m diepe kloof'], tips: ['VOORAF BOEKEN!', 'Luister naar de gids!', 'Waterproof camera!', 'Zwemkleding ONDER kleding aan'], warning: 'Water is KOUD (12Â°C)! Wetsuit wordt verstrekt.', price: 'â‚¬65-85 p.p.', duration: '3-4 uur op water', website: 'taratour.com', mustSee: true }},
        { time: '14:00', title: 'BBQ Lunch', subtitle: 'Aan de rivier', icon: 'ğŸ–', type: 'food', loc: 'tara_canyon', info: { desc: 'BBQ lunch na het raften', price: 'Inbegrepen' }},
        { time: '15:30', title: 'Tara Bridge', subtitle: '172m hoge brug!', icon: 'ğŸŒ‰', type: 'activity', loc: 'tara_bridge', info: { desc: 'ÄurÄ‘eviÄ‡a Tara - iconische brug 172m boven de rivier', tips: ['Wandelen over de brug', 'Zipline mogelijk (â‚¬20)', 'Spectaculaire fotos!'], mustSee: true }},
        { time: '20:00', title: 'Afscheidsdiner bergen', subtitle: 'Laatste avond Durmitor', icon: 'ğŸ½ï¸', type: 'food', loc: 'zabljak', info: { tips: ['Rakija proberen!'], price: 'â‚¬12-20 p.p.' }}
      ],
      6: [
        { time: '09:00', title: 'Check-out Å½abljak', subtitle: 'Naar de kust!', icon: 'ğŸ“¦', type: 'accommodation', loc: 'zabljak', info: { tips: ['~3.5 uur rijden naar Budva'] }},
        { time: '13:00', title: 'Check-in Budva', subtitle: 'Beach Apartment', icon: 'ğŸ ', type: 'accommodation', loc: 'budva', info: { price: 'â‚¬210 totaal (3 nachten)' }},
        { time: '15:30', title: 'Budva Old Town', subtitle: '2500 jaar oud', icon: 'ğŸ°', type: 'activity', loc: 'budva', info: { desc: 'Een van de oudste nederzettingen aan de Adriatische kust', highlights: ['Citadel met uitzicht', 'Stadsmuren', 'Smalle steegjes'], duration: '1-2 uur' }},
        { time: '17:30', title: 'â­ Sveti Stefan', subtitle: 'Iconisch eiland-hotel', icon: 'ğŸï¸', type: 'highlight', loc: 'sveti_stefan', info: { desc: 'HET iconische beeld van Montenegro - luxe eiland-hotel!', tips: ['Eiland zelf = Aman Resort (niet toegankelijk)', 'GRATIS uitzicht vanaf strand/weg', 'Beste fotos bij zonsondergang', 'Strand naast eiland is openbaar'], mustSee: true }},
        { time: '19:30', title: 'Diner met view', subtitle: 'Sveti Stefan uitzicht', icon: 'ğŸ½ï¸', type: 'food', loc: 'sveti_stefan', info: { price: 'â‚¬18-28 p.p.' }}
      ],
      7: [
        { time: '09:30', title: 'ğŸš€ Jetski!', subtitle: 'Langs de kust racen', icon: 'ğŸš€', type: 'highlight', loc: 'budva', info: { desc: 'Jetski over de Adriatische Zee!', tips: ['Boek ter plekke op strand', 'Vroeg = rustiger water', 'Zwemvest verplicht'], price: 'â‚¬30-60 p.p. (15-30 min)', duration: '15-30 min', website: 'budvawatersports.me', mustSee: true }},
        { time: '10:30', title: 'ğŸª‚ Parasailing!', subtitle: 'Vliegen boven Budva', icon: 'ğŸª‚', type: 'highlight', loc: 'budva', info: { desc: 'Zweef tot 60m boven de zee met uitzicht op Sveti Stefan!', tips: ['Samen = â‚¬80 voor duo', 'Geen ervaring nodig', 'Spectaculaire fotos!'], price: 'â‚¬50 solo / â‚¬80 duo', duration: '~15 min vlucht', website: 'budvawatersports.me', mustSee: true }},
        { time: '11:30', title: 'â­ Mogren Beach', subtitle: 'Mooiste strand relaxen', icon: 'ğŸ–ï¸', type: 'highlight', loc: 'mogren', info: { desc: 'Twee stranden verbonden door tunnel in de rotsen!', tips: ['Ligbedden â‚¬10-15', 'Restaurant op strand', 'Tunnel naar Mogren II'], mustSee: true }},
        { time: '13:00', title: 'Lunch op strand', subtitle: 'Beachbar vibes', icon: 'ğŸ½ï¸', type: 'food', loc: 'mogren', info: { mustTry: ['Verse vis', 'Calamares'], price: 'â‚¬10-18 p.p.' }},
        { time: '14:30', title: 'ğŸŒ Banana Boat', subtitle: 'Klassieke strandpret', icon: 'ğŸŒ', type: 'activity', loc: 'budva', info: { desc: 'Achter speedboot over de golven!', tips: ['Probeer niet te vallen! ğŸ˜„', 'Boek op strand'], price: 'â‚¬15-20 p.p.', duration: '~15 min' }},
        { time: '15:30', title: 'ğŸ„ Wakeboard / SUP', subtitle: 'Jaz Beach watersporten', icon: 'ğŸ„', type: 'activity', loc: 'jaz', info: { desc: 'Extra watersporten op Jaz Beach', tips: ['Jaz Beach = beste faciliteiten', 'SUP huren â‚¬10-20/uur', 'Wakeboard â‚¬30-50'], price: 'â‚¬10-50' }},
        { time: '18:30', title: 'Jaz Beach sunset', subtitle: 'Zonsondergang cocktails', icon: 'ğŸŒ…', type: 'beach', loc: 'jaz', info: { desc: 'Relaxen na actieve dag bij zonsondergang', tips: ['Sea Dance festival strand', 'Minder druk dan Budva', 'Mooie zonsondergang'] }},
        { time: '20:30', title: 'Diner', subtitle: 'Verdiend na sportieve dag!', icon: 'ğŸ½ï¸', type: 'food', loc: 'budva', info: { price: 'â‚¬20-35 p.p.' }}
      ],
      8: [
        { time: '10:00', title: 'â­ Skadar Lake', subtitle: 'Grootste meer van Balkan', icon: 'ğŸ¦…', type: 'highlight', loc: 'skadar', info: { desc: 'Nationaal Park - vogelparadijs!', highlights: ['Pelikanen', 'Aalscholvers', 'Reigers', 'Waterlelievelden'], tips: ['Boot vanuit Virpazar', 'Mei = waterlelies!'], mustSee: true }},
        { time: '10:30', title: 'Boottrip Skadar', subtitle: 'Waterlelievelden', icon: 'â›µ', type: 'activity', loc: 'virpazar', info: { desc: 'Boottocht door waterlelievelden', highlights: ['Waterlelies (mei = perfect!)', 'Vogeleilanden', 'Oude kloosters'], price: 'â‚¬15-25 p.p.', duration: '2-3 uur', website: 'skadarlake.com' }},
        { time: '13:30', title: 'Lunch + Wijnproeverij', subtitle: 'Lokale wijnen', icon: 'ğŸ·', type: 'food', loc: 'skadar', info: { desc: 'Regio beroemd om Vranac wijn!', mustTry: ['Vranac (rode wijn)', 'KrstaÄ (witte wijn)', 'Lokale kaas'], tips: ['Wijnhuizen rond Virpazar'], price: 'â‚¬15-25 p.p.' }},
        { time: '21:00', title: 'â­ Afscheidsdiner', subtitle: 'Beste restaurant!', icon: 'ğŸ½ï¸', type: 'highlight', loc: 'budva', info: { tips: ['Reserveer vooraf!', 'Rakija als digestief'], price: 'â‚¬30-45 p.p.', mustSee: true }}
      ],
      9: [
        { time: '08:00', title: 'Laatste ontbijt', subtitle: 'Aan zee', icon: 'ğŸ³', type: 'food', loc: 'budva', info: {} },
        { time: '10:00', title: 'Check-out', subtitle: 'Apartment Budva', icon: 'ğŸ“¦', type: 'accommodation', loc: 'budva', info: {} },
        { time: '10:30', title: 'Auto inleveren', subtitle: 'Tivat Airport', icon: 'ğŸš—', type: 'transport', loc: 'tivat', info: { tips: ['Volle tank!', 'Ruim op tijd!'], warning: 'Tank vol voor inleveren!' }},
        { time: '15:00', title: 'âœˆï¸ Vlucht naar huis', subtitle: 'Tivat â†’ Amsterdam', icon: 'âœˆï¸', type: 'highlight', loc: 'tivat', info: { desc: 'Terugvlucht naar Nederland', tips: ['Aankomst ~20:30 NL tijd'] }},
        { time: '20:30', title: 'ğŸ  Thuis!', subtitle: 'Welkom terug', icon: 'ğŸ ', type: 'transport', loc: 'tivat', info: {} }
      ]
    };

    const budget = {
      estimated: [
        { item: 'âœˆï¸ Vluchten (2p)', budget: 730, comfort: 850 },
        { item: 'ğŸ  Kotor (3n)', budget: 195, comfort: 250 },
        { item: 'ğŸ  Durmitor (2n)', budget: 100, comfort: 140 },
        { item: 'ğŸ  Budva (3n)', budget: 210, comfort: 280 },
        { item: 'ğŸš— Huurauto (8 dagen)', budget: 200, comfort: 280 },
        { item: 'â›½ Benzine (~600km)', budget: 60, comfort: 80 },
        { item: 'ğŸš£ Tara Rafting (2p)', budget: 140, comfort: 170 },
        { item: 'â›µ Kotor boottocht (2p)', budget: 60, comfort: 80 },
        { item: 'ğŸš€ Jetski (2p)', budget: 60, comfort: 100 },
        { item: 'ğŸª‚ Parasailing (duo)', budget: 80, comfort: 80 },
        { item: 'ğŸŒ Banana + Wakeboard', budget: 60, comfort: 80 },
        { item: 'â›µ Skadar boottrip (2p)', budget: 40, comfort: 50 },
        { item: 'ğŸ« Entreegelden', budget: 30, comfort: 40 },
        { item: 'ğŸ½ï¸ Eten (9 dagen)', budget: 350, comfort: 500 },
        { item: 'ğŸ¥ Reisverzekering', budget: 40, comfort: 60 },
        { item: 'ğŸ’° Buffer', budget: 85, comfort: 120 }
      ]
    };

    const checklistSections = [
      { title: 'ğŸ”´ NU BOEKEN', items: [
        { key: 'flights', label: 'âœˆï¸ Vluchten Amsterdam â†” Tivat' },
        { key: 'accomKotor', label: 'ğŸ  Accommodatie Kotor (3n)' },
        { key: 'accomDurmitor', label: 'ğŸ  Accommodatie Å½abljak (2n)' },
        { key: 'accomBudva', label: 'ğŸ  Accommodatie Budva (3n)' },
        { key: 'insurance', label: 'ğŸ¥ Reisverzekering' },
        { key: 'rafting', label: 'ğŸš£ TARA RAFTING BOEKEN!' }
      ]},
      { title: 'ğŸŸ  APRIL', items: [
        { key: 'carRental', label: 'ğŸš— Huurauto' },
        { key: 'boatTour', label: 'â›µ Bay of Kotor boottocht' },
        { key: 'watersports', label: 'ğŸš€ Watersport check' }
      ]},
      { title: 'ğŸ“¦ WEEK VOOR', items: [
        { key: 'mapsOffline', label: 'ğŸ“± Google Maps offline' },
        { key: 'printDocs', label: 'ğŸ–¨ï¸ Bevestigingen printen' },
        { key: 'eurosCash', label: 'ğŸ’¶ Euro\'s cash' }
      ]},
      { title: 'ğŸ§³ DOCUMENTEN', items: [
        { key: 'passport', label: 'Paspoort / ID' },
        { key: 'license', label: 'Rijbewijs' },
        { key: 'creditcard', label: 'Creditcard' },
        { key: 'ehic', label: 'EHIC kaart' }
      ]},
      { title: 'ğŸ’ INPAKKEN', items: [
        { key: 'hikingShoes', label: 'ğŸ¥¾ Wandelschoenen!' },
        { key: 'swimwear', label: 'ğŸ‘™ Zwemkleding (2x)' },
        { key: 'sunscreen', label: 'â˜€ï¸ Zonnebrand SPF50' },
        { key: 'rainJacket', label: 'ğŸ§¥ Regenjas (bergen!)' },
        { key: 'camera', label: 'ğŸ“· Camera + waterproof' }
      ]}
    ];

    checklistSections.forEach(sec => sec.items.forEach(i => { if (checklist[i.key] === undefined) checklist[i.key] = false; }));

    function getTypeClass(type) {
      const classes = {
        transport: 'bg-gradient-to-r from-amber-100 to-yellow-100 border-l-4 border-amber-500',
        accommodation: 'bg-gradient-to-r from-amber-100 to-yellow-100 border-l-4 border-yellow-500',
        highlight: 'bg-gradient-to-r from-orange-100 to-amber-100 border-l-4 border-orange-500',
        food: 'bg-gradient-to-r from-green-100 to-emerald-100 border-l-4 border-green-500',
        activity: 'bg-gradient-to-r from-violet-100 to-purple-100 border-l-4 border-purple-500',
        beach: 'bg-gradient-to-r from-cyan-100 to-blue-100 border-l-4 border-cyan-500',
        warning: 'bg-gradient-to-r from-red-200 to-rose-200 border-l-4 border-red-600'
      };
      return classes[type] || 'bg-gray-100 border-l-4 border-gray-400';
    }

    function setDay(d) { activeDay = d; render(); }
    function setTab(t) { activeTab = t; render(); }
    function openModal(act) { selectedModal = act; render(); }
    function closeModal() { selectedModal = null; render(); }
    function toggleCheck(key) { checklist[key] = !checklist[key]; localStorage.setItem('montenegroChecklist', JSON.stringify(checklist)); render(); }
    function togglePacking(key) { packingList[key] = !packingList[key]; localStorage.setItem('montenegroPackingList', JSON.stringify(packingList)); render(); }
    function toggleDarkMode() { darkMode = !darkMode; localStorage.setItem('montenegroDarkMode', darkMode.toString()); document.body.classList.toggle('dark', darkMode); render(); }

    function addExpense() {
      const desc = document.getElementById('expenseDesc')?.value;
      const amount = parseFloat(document.getElementById('expenseAmount')?.value);
      const cat = document.getElementById('expenseCategory')?.value || 'ğŸ’° Overig';
      if (desc && amount > 0) {
        expenses.push({ id: Date.now(), desc, amount, category: cat });
        localStorage.setItem('montenegroExpenses', JSON.stringify(expenses));
        render();
      }
    }
    function deleteExpense(id) { expenses = expenses.filter(e => e.id !== id); localStorage.setItem('montenegroExpenses', JSON.stringify(expenses)); render(); }

    function saveNote() {
      const note = document.getElementById('dayNoteInput')?.value;
      if (note && note.trim()) {
        if (!dayNotes[activeDay]) dayNotes[activeDay] = [];
        dayNotes[activeDay].push({ id: Date.now(), text: note, ts: new Date().toLocaleString('nl-NL') });
        localStorage.setItem('montenegroDayNotes', JSON.stringify(dayNotes));
        render();
      }
    }
    function deleteNote(id) { dayNotes[activeDay] = (dayNotes[activeDay] || []).filter(n => n.id !== id); localStorage.setItem('montenegroDayNotes', JSON.stringify(dayNotes)); render(); }

    function shareTrip() {
      if (navigator.share) navigator.share({ title: trip.title, url: window.location.href });
      else { navigator.clipboard.writeText(window.location.href); alert('Link gekopieerd!'); }
    }

    function exportTrip() {
      let txt = `${trip.title}\n${trip.dates}\n\n`;
      days.forEach(d => {
        txt += `=== DAG ${d.day}: ${d.title} ===\n`;
        (activities[d.day] || []).forEach(a => { txt += `${a.time} - ${a.title}\n`; });
        txt += '\n';
      });
      const blob = new Blob([txt], { type: 'text/plain' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'montenegro-trip.txt'; a.click();
    }

    // MAIN RENDER
    function render() {
      const day = days[activeDay - 1];
      const acts = activities[activeDay] || [];
      const accom = day.accom ? accommodations[day.accom] : null;

      const estBudget = budget.estimated.reduce((s, i) => s + i.budget, 0);
      const estComfort = budget.estimated.reduce((s, i) => s + i.comfort, 0);
      const totalExpenses = expenses.reduce((s, e) => s + e.amount, 0);
      const checkedCount = Object.values(checklist).filter(Boolean).length;
      const totalChecks = checklistSections.reduce((s, sec) => s + sec.items.length, 0);

      const tripDate = new Date('2026-05-16T00:00:00');
      const now = new Date();
      const diff = tripDate - now;
      const daysLeft = Math.ceil(diff / (1000 * 60 * 60 * 24));
      const weeksLeft = Math.floor(daysLeft / 7);
      const remainingDays = daysLeft % 7;

      let html = '';

      // HEADER
      html += `
        <div class="bg-white rounded-3xl p-5 shadow-lg mb-4">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-2xl font-bold text-gray-800">${trip.title}</h1>
              <p class="text-amber-600 font-medium">${trip.subtitle}</p>
              <p class="text-gray-500 text-sm mt-1">${trip.dates} â€¢ ${trip.persons} personen â€¢ ${trip.duration}</p>
            </div>
            <a href="/" class="text-gray-400 hover:text-gray-600">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </a>
          </div>
          <div class="flex flex-wrap gap-2 mt-3">
            ${daysLeft > 0 ? `
              <div class="inline-flex items-center gap-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white px-4 py-1.5 rounded-full text-sm font-bold shadow-lg">
                ğŸ”ï¸ Nog ${weeksLeft > 0 ? weeksLeft + ' weken' + (remainingDays > 0 ? ' en ' + remainingDays + ' dagen' : '') : daysLeft + ' dagen'}!
              </div>
            ` : daysLeft === 0 ? `
              <div class="inline-flex items-center gap-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white px-4 py-1.5 rounded-full text-sm font-bold shadow-lg animate-pulse">
                ğŸ‰ VANDAAG IS HET ZOVER!
              </div>
            ` : `
              <div class="inline-flex items-center gap-2 bg-gray-500 text-white px-4 py-1.5 rounded-full text-sm font-bold">
                âœ… Reis voltooid
              </div>
            `}
            ${weatherData ? `
              <div class="inline-flex items-center gap-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white px-3 py-1.5 rounded-full text-sm font-medium shadow">
                ${getWeatherEmoji(weatherData.current.weather_code)} ${Math.round(weatherData.current.temperature_2m)}Â°C
                <span class="text-white/70 text-xs">nu in Kotor</span>
              </div>
            ` : `
              <button onclick="fetchWeather()" class="inline-flex items-center gap-1 bg-cyan-100 text-cyan-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-cyan-200 transition">
                ğŸŒ¤ï¸ Weer laden
              </button>
            `}
            <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm">ğŸ° Kotor UNESCO</span>
            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm">ğŸš£ Tara Rafting</span>
          </div>
        </div>
      `;

      // TABS
      html += `<div class="flex gap-2 mb-4 overflow-x-auto hide-scrollbar">`;
      [
        { id: 'planning', label: 'ğŸ“… Planning' },
        { id: 'map', label: 'ğŸ—ºï¸ Kaart' },
        { id: 'budget', label: 'ğŸ’° Budget' },
        { id: 'checklist', label: `âœ… (${checkedCount}/${totalChecks})` },
        { id: 'packing', label: 'ğŸ’ Inpakken' }
      ].forEach(t => {
        html += `<button onclick="setTab('${t.id}')" class="px-4 py-2 rounded-xl font-medium whitespace-nowrap shadow ${activeTab === t.id ? 'bg-amber-600 text-white' : 'bg-white text-gray-700 hover:bg-amber-50'}">${t.label}</button>`;
      });
      html += `</div>`;

      // PLANNING TAB
      if (activeTab === 'planning') {
        html += `<div class="flex gap-2 overflow-x-auto pb-3 hide-scrollbar">`;
        days.forEach(d => {
          html += `<button onclick="setDay(${d.day})" class="flex items-center gap-2 px-4 py-2 rounded-xl font-medium whitespace-nowrap shadow ${activeDay === d.day ? 'bg-amber-600 text-white' : 'bg-white text-gray-700'}">${d.icon} Dag ${d.day}</button>`;
        });
        html += `</div>`;

        html += `
          <div class="bg-white rounded-2xl p-5 shadow-lg mb-4">
            <div class="flex items-center gap-4">
              <span class="text-5xl">${day.icon}</span>
              <div class="flex-1">
                <h2 class="text-2xl font-bold text-gray-800">Dag ${day.day}: ${day.title}</h2>
                <p class="text-gray-500">${day.date} â€¢ ${day.region}</p>
                <p class="text-amber-600 font-semibold">${day.highlight}</p>
              </div>
              ${day.weather ? `
              <div class="text-center bg-gradient-to-br from-sky-100 to-blue-100 rounded-xl px-3 py-2 border border-sky-200">
                <div class="text-2xl">${day.weather.icon}</div>
                <div class="text-lg font-bold text-gray-800">${day.weather.high}Â°</div>
                <div class="text-xs text-gray-500">mei gem</div>
              </div>
              ` : ''}
            </div>
            ${day.weather ? `
            <div class="mt-4 grid grid-cols-4 gap-2 text-center text-sm">
              <div class="bg-orange-50 rounded-lg p-2"><div class="text-orange-500">ğŸŒ¡ï¸ Max</div><div class="font-bold">${day.weather.high}Â°C</div></div>
              <div class="bg-blue-50 rounded-lg p-2"><div class="text-blue-500">ğŸŒ¡ï¸ Min</div><div class="font-bold">${day.weather.low}Â°C</div></div>
              <div class="bg-yellow-50 rounded-lg p-2"><div class="text-yellow-600">â˜€ï¸ Zon</div><div class="font-bold">10u</div></div>
              <div class="bg-cyan-50 rounded-lg p-2"><div class="text-cyan-600">ğŸ’§ Regen</div><div class="font-bold">${day.weather.rain}%</div></div>
            </div>
            ${day.weather.note ? `<div class="mt-2 bg-amber-50 border border-amber-200 rounded-lg p-2 text-sm text-amber-700 text-center">${day.weather.note}</div>` : ''}
            <div class="mt-2 text-xs text-gray-400 text-center">ğŸ“Š Historisch gemiddelde mei</div>
            ` : ''}
            ${accom ? `<div class="mt-3 bg-amber-50 rounded-xl p-3"><span class="text-xs text-amber-600 font-bold">ğŸ¨ ACCOMMODATIE</span><div class="font-bold text-amber-800">${accom.name}</div><div class="text-sm text-amber-600">${accom.area}</div></div>` : ''}
          </div>
        `;

        html += `<div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-xl p-4 mb-4 text-sm flex items-center gap-3"><span class="text-xl">ğŸ’¡</span><span><strong>Klik op een activiteit</strong> voor gedetailleerde info!</span></div>`;

        html += `<div class="bg-white rounded-2xl p-4 shadow-lg mb-4"><div class="space-y-2">`;
        acts.forEach((act, idx) => {
          const prevLoc = idx > 0 ? acts[idx-1].loc : (accom ? day.accom : null);
          const dist = prevLoc && act.loc ? calcDist(prevLoc, act.loc) : null;
          html += `
            <div onclick='openModal(${JSON.stringify(act).replace(/'/g, "\\'")})' class="rounded-xl p-3 cursor-pointer hover:shadow-md transition ${getTypeClass(act.type)}">
              <div class="flex items-center gap-3">
                <div class="font-mono font-bold text-gray-700 w-12 text-center">${act.time}</div>
                <div class="text-2xl">${act.icon}</div>
                <div class="flex-1 min-w-0">
                  <div class="font-bold text-gray-800">${act.title}</div>
                  <div class="text-gray-600 text-sm truncate">${act.subtitle}</div>
                </div>
                ${dist ? `<div class="text-xs bg-white/60 px-2 py-1 rounded-full hidden md:block">${dist}km</div>` : ''}
                <div class="text-gray-400">â†’</div>
              </div>
            </div>
          `;
        });
        html += `</div></div>`;

        // Special day info boxes
        if (activeDay === 5) {
          html += `
            <div class="bg-gradient-to-r from-blue-100 to-cyan-100 border border-blue-300 rounded-2xl p-4 mb-4">
              <h4 class="font-bold text-blue-800 mb-2">ğŸš£ RAFTING DAG - WAT MEENEMEN</h4>
              <div class="flex flex-wrap gap-2">
                ${['ğŸ‘™ Zwemkleding (aan!)', 'ğŸ‘Ÿ Sportschoenen', 'â˜€ï¸ Zonnebrand', 'ğŸ“· Waterproof camera', 'ğŸ§´ Handdoek'].map(i => `<span class="bg-blue-200 text-blue-800 px-3 py-1 rounded-full text-sm">${i}</span>`).join('')}
              </div>
              <p class="mt-2 text-blue-700 text-sm">âš ï¸ Water is KOUD (12Â°C) maar wetsuit wordt verstrekt!</p>
            </div>
          `;
        }

        if (activeDay === 7) {
          html += `
            <div class="bg-gradient-to-r from-amber-100 to-orange-100 border border-amber-300 rounded-2xl p-4 mb-4">
              <h4 class="font-bold text-amber-800 mb-2">ğŸš€ WATERSPORT DAG - PRIJZEN</h4>
              <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                <div class="bg-white p-2 rounded-lg"><strong>ğŸš€ Jetski</strong><br/>â‚¬30-60 p.p.</div>
                <div class="bg-white p-2 rounded-lg"><strong>ğŸª‚ Parasailing</strong><br/>â‚¬50/â‚¬80 duo</div>
                <div class="bg-white p-2 rounded-lg"><strong>ğŸŒ Banana</strong><br/>â‚¬15-20 p.p.</div>
                <div class="bg-white p-2 rounded-lg"><strong>ğŸ„ Wakeboard</strong><br/>â‚¬30-50</div>
                <div class="bg-white p-2 rounded-lg"><strong>ğŸ›¶ SUP</strong><br/>â‚¬10-20/uur</div>
              </div>
            </div>
          `;
        }

        // Day Notes
        html += `
          <div class="bg-gradient-to-r from-amber-100 to-orange-100 rounded-2xl p-4 shadow">
            <h4 class="font-bold text-amber-800 mb-3">ğŸ“ Notities - Dag ${activeDay}</h4>
            <div class="flex gap-2 mb-3">
              <input type="text" id="dayNoteInput" placeholder="Schrijf notitie..." class="flex-1 px-4 py-2 rounded-xl border text-sm">
              <button onclick="saveNote()" class="bg-amber-600 text-white px-4 py-2 rounded-xl font-medium">+</button>
            </div>
            ${(dayNotes[activeDay] || []).length > 0 ? `<div class="space-y-2">${(dayNotes[activeDay] || []).map(n => `
              <div class="bg-white rounded-lg p-3 flex justify-between">
                <div><p class="text-gray-800">${n.text}</p><p class="text-xs text-gray-400">${n.ts}</p></div>
                <button onclick="deleteNote(${n.id})" class="text-red-400 hover:text-red-600">Ã—</button>
              </div>
            `).join('')}</div>` : ''}
          </div>
        `;
      }

      // MAP TAB
      if (activeTab === 'map') {
        const dayLocs = acts.filter(a => a.loc && locations[a.loc]).map(a => ({ ...a, ...locations[a.loc] }));
        
        html += `<div class="flex gap-2 overflow-x-auto pb-3 hide-scrollbar mb-4">`;
        days.forEach(d => {
          html += `<button onclick="setDay(${d.day}); setTab('map');" class="flex items-center gap-2 px-4 py-2 rounded-xl font-medium whitespace-nowrap shadow ${activeDay === d.day ? 'bg-amber-600 text-white' : 'bg-white text-gray-700'}">${d.icon} Dag ${d.day}</button>`;
        });
        html += `</div>`;

        html += `
          <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
            <div class="p-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white">
              <h3 class="font-bold text-lg">ğŸ—ºï¸ Dag ${activeDay}: ${day.title}</h3>
              <p class="text-white/80 text-sm">${dayLocs.length} locaties</p>
            </div>
            <div class="p-4 space-y-2">
              ${dayLocs.map((loc, i) => `
                <a href="${getMapsUrl(loc.loc)}" target="_blank" class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl hover:bg-amber-50 transition">
                  <div class="w-8 h-8 rounded-full bg-amber-600 text-white flex items-center justify-center font-bold text-sm">${i+1}</div>
                  <span class="text-2xl">${loc.icon}</span>
                  <div class="flex-1"><div class="font-medium text-gray-800">${loc.title}</div><div class="text-sm text-gray-500">${loc.time}</div></div>
                  <span class="text-amber-500">ğŸ“</span>
                </a>
              `).join('')}
            </div>
            ${dayLocs.length > 1 ? `
              <div class="p-4 bg-amber-50 border-t">
                <a href="https://www.google.com/maps/dir/${dayLocs.map(l => `${l.lat},${l.lng}`).join('/')}" target="_blank" class="block w-full bg-amber-600 text-white text-center py-3 rounded-xl font-bold">ğŸ—ºï¸ Open volledige route</a>
              </div>
            ` : ''}
          </div>
        `;
      }

      // BUDGET TAB
      if (activeTab === 'budget') {
        html += `
          <div class="space-y-4">
            <div class="bg-gradient-to-r from-amber-500 to-orange-500 rounded-2xl p-5 text-white shadow-lg">
              <h3 class="font-bold text-lg mb-3">ğŸ’¸ Uitgaven Tracker</h3>
              <div class="grid grid-cols-3 gap-2 mb-3">
                <input type="text" id="expenseDesc" placeholder="Omschrijving" class="col-span-2 px-3 py-2 rounded-lg text-gray-800 text-sm">
                <input type="number" id="expenseAmount" placeholder="â‚¬" step="0.01" class="px-3 py-2 rounded-lg text-gray-800 text-sm">
              </div>
              <div class="flex gap-2">
                <select id="expenseCategory" class="flex-1 px-3 py-2 rounded-lg text-gray-800 text-sm">
                  <option>ğŸ½ï¸ Eten</option><option>ğŸš— Vervoer</option><option>ğŸ« Activiteit</option><option>ğŸ Shopping</option><option>ğŸ’° Overig</option>
                </select>
                <button onclick="addExpense()" class="bg-white text-amber-600 px-4 py-2 rounded-lg font-bold">+</button>
              </div>
              ${expenses.length > 0 ? `<div class="mt-4 pt-4 border-t border-white/30 flex justify-between"><span>Totaal uitgegeven:</span><span class="text-2xl font-bold">â‚¬${totalExpenses.toFixed(2)}</span></div>` : ''}
            </div>

            ${expenses.length > 0 ? `
              <div class="bg-white rounded-2xl p-4 shadow-lg">
                <h3 class="font-bold text-gray-800 mb-3">ğŸ“ Uitgaven</h3>
                <div class="space-y-2 max-h-48 overflow-y-auto">
                  ${expenses.slice().reverse().map(e => `
                    <div class="flex justify-between items-center py-2 px-3 bg-gray-50 rounded-lg">
                      <div><span class="text-sm text-gray-500">${e.category}</span> <span class="font-medium text-gray-800">${e.desc}</span></div>
                      <div class="flex items-center gap-2">
                        <span class="font-bold text-amber-600">â‚¬${e.amount.toFixed(2)}</span>
                        <button onclick="deleteExpense(${e.id})" class="text-gray-400 hover:text-red-500">Ã—</button>
                      </div>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}

            <div class="bg-white rounded-2xl p-4 shadow-lg">
              <h3 class="font-bold text-gray-800 mb-3">ğŸ“Š Geschatte Kosten</h3>
              <div class="space-y-1 max-h-64 overflow-y-auto">
                ${budget.estimated.map(i => `
                  <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="text-sm text-gray-700">${i.item}</span>
                    <span class="font-mono text-sm text-gray-600">â‚¬${i.budget} | â‚¬${i.comfort}</span>
                  </div>
                `).join('')}
              </div>
              <div class="mt-3 pt-3 border-t-2 border-amber-200 flex justify-between font-bold">
                <span class="text-gray-800">TOTAAL</span>
                <span class="text-gray-800">â‚¬${estBudget} | â‚¬${estComfort}</span>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div class="bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl p-4 text-white text-center">
                <div class="text-sm opacity-80">ğŸ’š Budget</div>
                <div class="text-3xl font-bold">â‚¬${estBudget}</div>
                <div class="text-sm opacity-80">â‚¬${Math.round(estBudget/2)} p.p.</div>
              </div>
              <div class="bg-gradient-to-br from-amber-500 to-orange-600 rounded-2xl p-4 text-white text-center">
                <div class="text-sm opacity-80">âœ¨ Comfort</div>
                <div class="text-3xl font-bold">â‚¬${estComfort}</div>
                <div class="text-sm opacity-80">â‚¬${Math.round(estComfort/2)} p.p.</div>
              </div>
            </div>
          </div>
        `;
      }

      // CHECKLIST TAB
      if (activeTab === 'checklist') {
        html += `<div class="space-y-4">`;
        checklistSections.forEach(sec => {
          const secChecked = sec.items.filter(i => checklist[i.key]).length;
          html += `
            <div class="bg-white rounded-2xl p-4 shadow-lg">
              <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">${sec.title} <span class="text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full">${secChecked}/${sec.items.length}</span></h3>
              <div class="space-y-2">
                ${sec.items.map(i => `
                  <label class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg cursor-pointer">
                    <input type="checkbox" ${checklist[i.key] ? 'checked' : ''} onchange="toggleCheck('${i.key}')" class="w-5 h-5 rounded text-amber-600">
                    <span class="${checklist[i.key] ? 'line-through text-gray-400' : 'text-gray-700'}">${i.label}</span>
                  </label>
                `).join('')}
              </div>
            </div>
          `;
        });
        html += `
          <div class="bg-gradient-to-r from-amber-500 to-orange-500 rounded-2xl p-5 text-white">
            <h3 class="font-bold mb-3">ğŸ“Š Voortgang</h3>
            <div class="bg-white/20 rounded-full h-4 mb-2">
              <div class="bg-white rounded-full h-4 transition-all" style="width: ${Math.max((checkedCount/totalChecks)*100, 5)}%"></div>
            </div>
            <div class="text-center">${checkedCount} / ${totalChecks} items</div>
          </div>
        </div>`;
      }

      // PACKING TAB
      if (activeTab === 'packing') {
        const packingChecked = Object.keys(packingList).filter(k => packingList[k]).length;
        const packingTotal = Object.values(packingCategories).reduce((sum, cat) => sum + cat.items.length, 0);
        
        html += `
          <div class="space-y-4">
            <div class="bg-gradient-to-r from-amber-500 to-orange-500 rounded-2xl p-5 text-white">
              <h2 class="text-xl font-bold mb-2">ğŸ’ Slimme Inpaklijst</h2>
              <p class="text-white/80 text-sm">Automatisch gegenereerd voor Montenegro!</p>
              <div class="mt-3 flex items-center gap-3">
                <div class="flex-1 bg-white/20 rounded-full h-3">
                  <div class="bg-white rounded-full h-3 transition-all" style="width: ${Math.max((packingChecked/packingTotal)*100, 3)}%"></div>
                </div>
                <span class="font-bold">${packingChecked}/${packingTotal}</span>
              </div>
            </div>
            
            ${Object.entries(packingCategories).map(([key, cat]) => `
              <div class="bg-white rounded-2xl p-5 shadow-lg">
                <h3 class="font-bold mb-3 text-lg">${cat.title}</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                  ${cat.items.map((item, idx) => {
                    const itemKey = key + '_' + idx;
                    return `
                      <label class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg cursor-pointer">
                        <input type="checkbox" ${packingList[itemKey] ? 'checked' : ''} onchange="togglePacking('${itemKey}')" class="w-5 h-5 rounded text-amber-600">
                        <span class="${packingList[itemKey] ? 'line-through text-gray-400' : 'text-gray-700'}">${item}</span>
                      </label>
                    `;
                  }).join('')}
                </div>
              </div>
            `).join('')}
            
            <div class="bg-amber-50 border border-amber-200 rounded-2xl p-5">
              <h3 class="font-bold text-amber-800 mb-2">ğŸ’¡ Pro Tips Montenegro</h3>
              <ul class="text-amber-700 text-sm space-y-1">
                <li>â€¢ Durmitor bergen: warme kleding ESSENTIEEL (6-17Â°C)</li>
                <li>â€¢ Tara rafting: zwemkleding ONDER je kleding aan!</li>
                <li>â€¢ Wandelschoenen voor Kotor fortress (1350 treden!)</li>
              </ul>
            </div>
          </div>
        `;
      }

      // MODAL
      if (selectedModal) {
        const m = selectedModal;
        const info = m.info || {};
        const accomLoc = day.accom || 'kotor';
        const dist = m.loc ? calcDist(accomLoc, m.loc) : null;

        html += `
          <div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50" onclick="closeModal()">
            <div class="bg-white rounded-3xl max-w-lg w-full max-h-[85vh] overflow-y-auto shadow-2xl" onclick="event.stopPropagation()">
              <div class="p-5 ${getTypeClass(m.type)} rounded-t-3xl">
                <div class="flex justify-between items-start">
                  <div class="flex items-center gap-3">
                    <span class="text-4xl">${m.icon}</span>
                    <div>
                      <h3 class="text-xl font-bold text-gray-800">${m.title}</h3>
                      <p class="text-gray-600">${m.time} â€¢ ${m.subtitle}</p>
                    </div>
                  </div>
                  <button onclick="closeModal()" class="text-3xl text-gray-400 hover:text-gray-600">Ã—</button>
                </div>
              </div>
              <div class="p-5 space-y-4">
                ${dist ? `
                  <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-4">
                    <h4 class="font-bold text-blue-800 mb-2">ğŸ“ Afstanden</h4>
                    <div class="bg-white p-3 rounded-xl shadow-sm">
                      <div class="text-gray-500 text-xs">Vanaf accommodatie</div>
                      <div class="font-bold text-blue-700 text-lg">${dist} km</div>
                      <div class="text-xs text-gray-500">${estTime(dist)}</div>
                    </div>
                  </div>
                ` : ''}
                ${info.desc ? `<div><h4 class="font-bold text-gray-700 mb-1">ğŸ“– Beschrijving</h4><p class="text-gray-600">${info.desc}</p></div>` : ''}
                ${info.highlights ? `<div><h4 class="font-bold text-gray-700 mb-2">âœ¨ Highlights</h4><div class="flex flex-wrap gap-2">${info.highlights.map(h => `<span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm">${h}</span>`).join('')}</div></div>` : ''}
                ${info.price ? `<div class="bg-green-50 p-4 rounded-xl"><h4 class="font-bold text-green-800 mb-1">ğŸ’° Kosten</h4><p class="text-green-700 font-semibold text-lg">${info.price}</p></div>` : ''}
                ${info.duration ? `<div class="flex items-center gap-2 bg-gray-50 p-3 rounded-xl"><span>â±ï¸</span><strong>Duur:</strong> ${info.duration}</div>` : ''}
                ${info.tips ? `<div><h4 class="font-bold text-gray-700 mb-2">ğŸ’¡ Tips</h4><ul class="space-y-1">${info.tips.map(t => `<li class="text-sm bg-blue-50 text-blue-800 p-2 rounded-lg">â€¢ ${t}</li>`).join('')}</ul></div>` : ''}
                ${info.mustTry ? `<div><h4 class="font-bold text-gray-700 mb-2">ğŸ´ Must Try</h4><div class="flex flex-wrap gap-2">${info.mustTry.map(t => `<span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm">${t}</span>`).join('')}</div></div>` : ''}
                ${info.recommendations ? `<div><h4 class="font-bold text-gray-700 mb-2">ğŸ¯ Aanbevelingen</h4><div class="flex flex-wrap gap-2">${info.recommendations.map(r => `<span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm">${r}</span>`).join('')}</div></div>` : ''}
                ${info.warning ? `<div class="bg-red-50 border border-red-200 p-4 rounded-xl"><h4 class="font-bold text-red-800 mb-1">âš ï¸ Let op!</h4><p class="text-red-700">${info.warning}</p></div>` : ''}
                ${info.mustSee ? `<div class="bg-gradient-to-r from-amber-100 to-orange-100 p-4 rounded-xl text-center"><span class="text-2xl">â­</span><span class="font-bold text-gray-800 ml-2">MUST SEE / DO!</span></div>` : ''}
                ${info.website ? `<a href="https://${info.website}" target="_blank" rel="noopener" class="block w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white text-center py-3 px-4 rounded-xl font-semibold hover:from-green-600 hover:to-emerald-700 transition-all shadow-lg mb-2">ğŸ« Boek nu op ${info.website}</a>` : ''}
                ${m.loc && getMapsUrl(m.loc) ? `<a href="${getMapsUrl(m.loc)}" target="_blank" class="block w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white text-center py-3 px-4 rounded-xl font-semibold">ğŸ“ Open in Google Maps</a>` : ''}
              </div>
            </div>
          </div>
        `;
      }

      // FOOTER
      html += `
        <div class="mt-6 space-y-3 text-center">
          <div class="flex flex-wrap justify-center gap-2">
            <button onclick="shareTrip()" class="bg-gradient-to-r from-amber-500 to-orange-500 text-white px-4 py-2 rounded-xl font-bold shadow">ğŸ”— Deel</button>
            <button onclick="exportTrip()" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-xl font-bold shadow">ğŸ“„ Export</button>
            <button onclick="toggleDarkMode()" class="bg-gradient-to-r from-gray-600 to-gray-800 text-white px-4 py-2 rounded-xl font-bold shadow">${darkMode ? 'â˜€ï¸ Light' : 'ğŸŒ™ Dark'}</button>
          </div>
          <p class="text-gray-600 text-sm">ğŸ”ï¸ Montenegro Adventure 2026 ğŸ”ï¸</p>
          <a href="/" class="text-amber-600 hover:underline text-sm">â† Terug naar overzicht</a>
        </div>
      `;

      document.getElementById('app').innerHTML = html;
    }

    render();
  </script>
</body>
</html>
